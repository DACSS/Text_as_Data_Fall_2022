---
title: "Blog Post 2"
author: "Mani Shanker Kamarapu"
desription: "Acquiring data"
date: "10/2/2022"
format:
  html:
    df-print: paged
    css: styles.css
    toc: true
    code-fold: true
    code-copy: true
    code-tools: true
categories:
  - Post2
  - ManiShankerKamarapu
  - Amazon Review analysis
---

::: callout-tip
## New Research Questions

I specifically focused on Amazon reviews. I wish to perform a Sentiment Analysis on reviews related to the best selling book series in Amazon by different customers. In the first part, I wish to collect reviews related to these books (Web scraping) and prepare the data.

In the next part, I wish to conduct a social network analysis and visualize the underlying emotions (sentiments) of the reviews.
:::

## Data sources

I am web-scrapping the data using *rvest* package from *https://amazon.com* and concentarting mainly on the top selling book series.

## Loading the libraries

```{r}
library(polite)
library(rvest)
library(tidyverse)
library(stringr)
library(quanteda)
library(tidyr)
library(quanteda.textplots)

knitr::opts_chunk$set(echo = TRUE)
```

```{r}
bow("https://www.amazon.com/")
```


```{r}
scrape_amazon <- function(ASIN, page_num){
  
  url_reviews <- paste0("https://www.amazon.com/product-reviews/",ASIN,"/?pageNumber=",page_num)
  
  doc <- read_html(url_reviews) # Assign results to `doc`
  
  # Review Title
  doc %>% 
    html_nodes("[class='a-size-base a-link-normal review-title a-color-base review-title-content a-text-bold']") %>%
    html_text() -> review_title
  
  # Review Text
  doc %>% 
    html_nodes("[class='a-size-base review-text review-text-content']") %>%
    html_text() -> review_text
  
  # Number of stars in review
  doc %>%
    html_nodes("[data-hook='review-star-rating']") %>%
    html_text() -> review_star
  
  # Return a tibble
  tibble(review_title,
         review_text,
         review_star,
         page = page_num) %>% return()
}
```

```{r}
out <- scrape_amazon("B0001DBI1Q", 1)
for (i in 2:500) {
  out <- bind_rows(out, scrape_amazon("B0001DBI1Q", i))
  if((i %% 3) == 0){
    Sys.sleep(2) # Take an additional two second break
  }
}
out
```

```{r}
text <- corpus(c(out$review_text))
text <- tokens(text, remove_punct=TRUE, remove_numbers = TRUE) %>%
             tokens_select(pattern=stopwords("en"),
                            selection="remove")
text
```

```{r}
textplot_wordcloud(dfm(text))
```



## Further study

I have scrapped and collect the data for one of the book series reviews and planning to do the same for the top other book series and analysis the reviews and do the models based on the reviews.
