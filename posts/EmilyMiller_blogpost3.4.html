<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Emily Miller">
<meta name="dcterms.date" content="2022-10-16">

<title>Text-as-Data Fall 2022 - Blog Post 3: Preprocessing Medical Textbooks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/DACSS_Round_Network.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<meta name="twitter:title" content="Text-as-Data Fall 2022 - Blog Post 3: Preprocessing Medical Textbooks">
<meta name="twitter:description" content="Questions:">
<meta name="twitter:creator" content="@UMassDACSS">
<meta name="twitter:site" content="@UMassDACSS">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/UMass White Wordmark Horiz.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Text-as-Data Fall 2022</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://dacss.github.io/Text_as_Data_Fall_2022/">
 <span class="menu-text">Fall 2022</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html">
 <span class="menu-text">Contributors</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://umass.edu/sbs/dacss">
 <span class="menu-text">DACSS</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/DACSS/Text_as_Data_Fall_2022"><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#recap" id="toc-recap" class="nav-link active" data-scroll-target="#recap">Recap</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#dataset-initial-cleaning" id="toc-dataset-initial-cleaning" class="nav-link" data-scroll-target="#dataset-initial-cleaning">Dataset Initial Cleaning</a>
  <ul class="collapse">
  <li><a href="#pdfs-from-the-inter-library-loan" id="toc-pdfs-from-the-inter-library-loan" class="nav-link" data-scroll-target="#pdfs-from-the-inter-library-loan">PDFs from the Inter-library Loan</a></li>
  <li><a href="#internet-archive-data" id="toc-internet-archive-data" class="nav-link" data-scroll-target="#internet-archive-data">Internet Archive Data</a></li>
  </ul></li>
  <li><a href="#cleaning" id="toc-cleaning" class="nav-link" data-scroll-target="#cleaning">Cleaning</a></li>
  <li><a href="#cleaning-using-dictionaries" id="toc-cleaning-using-dictionaries" class="nav-link" data-scroll-target="#cleaning-using-dictionaries">Cleaning Using Dictionaries</a>
  <ul class="collapse">
  <li><a href="#overview-1" id="toc-overview-1" class="nav-link" data-scroll-target="#overview-1">Overview</a></li>
  <li><a href="#pre-1970s-text-acquisition-and-cleaning" id="toc-pre-1970s-text-acquisition-and-cleaning" class="nav-link" data-scroll-target="#pre-1970s-text-acquisition-and-cleaning">Pre-1970’s Text Acquisition and Cleaning</a></li>
  <li><a href="#post-1970s-text-acquisition-and-cleaning" id="toc-post-1970s-text-acquisition-and-cleaning" class="nav-link" data-scroll-target="#post-1970s-text-acquisition-and-cleaning">Post 1970’s Text Acquisition and Cleaning</a></li>
  <li><a href="#applying-dictionaries" id="toc-applying-dictionaries" class="nav-link" data-scroll-target="#applying-dictionaries">Applying Dictionaries</a></li>
  <li><a href="#medical-dictionaries-fuzzy-join" id="toc-medical-dictionaries-fuzzy-join" class="nav-link" data-scroll-target="#medical-dictionaries-fuzzy-join">Medical Dictionaries: Fuzzy Join</a></li>
  <li><a href="#hunspell-dictionary-stringdist" id="toc-hunspell-dictionary-stringdist" class="nav-link" data-scroll-target="#hunspell-dictionary-stringdist">Hunspell Dictionary: Stringdist</a></li>
  </ul></li>
  <li><a href="#word-cloud" id="toc-word-cloud" class="nav-link" data-scroll-target="#word-cloud">Word Cloud</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Blog Post 3: Preprocessing Medical Textbooks</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">hw3</div>
    <div class="quarto-category">blogpost3</div>
    <div class="quarto-category">Emily Miller</div>
    <div class="quarto-category">internetarchivebooks</div>
    <div class="quarto-category">internetarchive</div>
    <div class="quarto-category">tidyverse</div>
    <div class="quarto-category">tidytext</div>
    <div class="quarto-category">stringdist</div>
    <div class="quarto-category">fuzzyjoin</div>
    <div class="quarto-category">quanteda</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Emily Miller </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 16, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="recap" class="level1">
<h1>Recap</h1>
<p><strong>Questions:</strong></p>
<ul>
<li>Is there a difference in language use between penises and vulvas?</li>
<li>Is there a change in language use over time?</li>
</ul>
<p><strong>How:</strong> Compare language use in anatomy textbooks</p>
</section>
<section id="overview" class="level1">
<h1>Overview</h1>
<p>This blog post goes over the steps I take to clean my dataset and visualize my work. Because I had to go through so many steps for the initial cleaning, I decided to dedicate a blog post to it. I follow generally the following outline:</p>
<ol type="1">
<li>Dataset initial cleaning, where I remove punctuation and extra characters</li>
<li>Cleaning using dictionaries that I build from book indexes</li>
</ol>
<ul>
<li>Hunspell for identifying mispelled words</li>
</ul>
<ol start="3" type="1">
<li>Visualizing with a word cloud</li>
</ol>
</section>
<section id="dataset-initial-cleaning" class="level1">
<h1>Dataset Initial Cleaning</h1>
<section id="pdfs-from-the-inter-library-loan" class="level3">
<h3 class="anchored" data-anchor-id="pdfs-from-the-inter-library-loan">PDFs from the Inter-library Loan</h3>
<p>I downloaded a number of other books that I couldn’t retrieve from the Internet Archive through UMass’s Internlibrary Loan system. Most of the metadata (title, dates) are contained in the filenames of the PDFs, so I add this information in the code below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">raw_files =</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/unabsorbed_pdfs"</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#add information about the dates of the files where the file doesn't describe it</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>pdfs<span class="ot">&lt;-</span> temp <span class="sc">%&gt;%</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  rowwise <span class="sc">%&gt;%</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">files =</span> <span class="fu">str_remove_all</span>(raw_files, <span class="st">"_"</span>),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">files =</span> <span class="fu">str_replace_all</span>(files, <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>, <span class="st">"_"</span>),</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">dates =</span> <span class="fu">str_extract</span>(files, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">()</span><span class="sc">\\</span><span class="st">d{4}(?=</span><span class="sc">\\</span><span class="st">))"</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">dates =</span> <span class="fu">as.numeric</span>(dates)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dates =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(files, <span class="st">"Advances_in_Anatomy,_Embryology"</span>) <span class="sc">~</span> <span class="dv">2004</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(files, <span class="st">"</span><span class="sc">\\</span><span class="st">(Current_Clinical_Urology"</span>)<span class="sc">~</span> <span class="dv">2007</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    T<span class="sc">~</span>dates</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#clean the titles</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>pdfs<span class="ot">&lt;-</span> pdfs <span class="sc">%&gt;%</span> </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">titles =</span> <span class="fu">str_extract</span>(files, <span class="st">"(?&lt;=-).*(?=</span><span class="sc">\\</span><span class="st">,|-.*-|-</span><span class="sc">\\</span><span class="st">w|</span><span class="sc">\\</span><span class="st">()"</span>),</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">titles =</span> <span class="fu">str_replace_all</span>(titles, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span> , <span class="st">"_"</span>),</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">titles =</span> <span class="fu">str_replace_all</span>( titles, <span class="st">"Evidence-Based"</span>, <span class="st">"Evidence_Based"</span>),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">titles =</span> <span class="fu">str_replace</span>(titles, <span class="st">"-|,"</span>, <span class="st">" "</span>),</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">titles =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(titles, <span class="st">" "</span>), </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">str_extract</span>(titles, <span class="st">".*(?= )"</span>), titles),</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">titles =</span> <span class="fu">str_replace_all</span>(titles, <span class="st">"_+"</span> , <span class="st">" "</span>),</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">titles =</span> <span class="fu">trimws</span>(titles, <span class="at">which =</span> <span class="st">"both"</span>), </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">titles =</span> <span class="fu">tolower</span>(titles))</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>pdfs<span class="ot">&lt;-</span>pdfs <span class="sc">%&gt;%</span> </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">titles =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    raw_files <span class="sc">==</span> <span class="st">"3-540-37363-2.pdf"</span> <span class="sc">~</span> <span class="st">"applied physiology in intensive care medicine"</span>,</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    raw_files <span class="sc">==</span> <span class="st">"978-1-59745-142-0.pdf"</span> <span class="sc">~</span><span class="st">"obstetrics in family medicine"</span>,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    raw_files <span class="sc">==</span> <span class="st">"978-1-59745-469-8.pdf"</span> <span class="sc">~</span> <span class="st">"womens health in clinical practice"</span>,</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    raw_files <span class="sc">==</span> <span class="st">"b138098.pdf"</span> <span class="sc">~</span> <span class="st">"scheins common sense emergency abdominal surgery"</span>,</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    T <span class="sc">~</span> titles</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  ), </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">dates =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    raw_files <span class="sc">==</span> <span class="st">"b138098.pdf"</span> <span class="sc">~</span> <span class="dv">2005</span>,</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    raw_files <span class="sc">==</span> <span class="st">"978-1-59745-469-8.pdf"</span> <span class="sc">~</span> <span class="dv">2008</span>,</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    raw_files <span class="sc">==</span> <span class="st">"978-1-59745-142-0.pdf"</span> <span class="sc">~</span> <span class="dv">2006</span>,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    raw_files <span class="sc">==</span> <span class="st">"3-540-37363-2.pdf"</span> <span class="sc">~</span><span class="dv">2006</span>,</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    T<span class="sc">~</span> dates</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pdfs <span class="sc">%&gt;%</span> head</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 4
# Rowwise: 
# … with 4 variables: raw_files &lt;chr&gt;, files &lt;chr&gt;, dates &lt;dbl&gt;, titles &lt;chr&gt;</code></pre>
</div>
</div>
<p>Next, I get the names of the files to read into R from my directories. Because I needed to remove the punctuation of the file names for the OCR (it was throwing some errors), I have to also modify the filenames in R so I can join them.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>pdfs1<span class="ot">&lt;-</span> pdfs <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp =</span> <span class="fu">str_replace_all</span>(raw_files, <span class="fu">c</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span> <span class="ot">=</span> <span class="st">"QQQ"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"[[:punct:]]|</span><span class="sc">\\</span><span class="st">s+"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"QQQ"</span> <span class="ot">=</span> <span class="st">"."</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"</span><span class="sc">\\</span><span class="st">.pdf"</span> <span class="ot">=</span> <span class="st">""</span>)),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp2 =</span> <span class="fu">str_replace_all</span>(raw_files, <span class="fu">c</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.pdf$"</span> <span class="ot">=</span> <span class="st">""</span>)),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp2 =</span><span class="fu">ifelse</span>(<span class="fu">str_detect</span>(titles, <span class="st">"clinical anatomy a revision"</span>),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"HaroldEllisClinicalAnatomyARevisionandAppliedAnatomyforClinicalStudents"</span>, temp2)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">matches</span>(<span class="st">"temp"</span>), <span class="at">values_to =</span> <span class="st">"files1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(titles, dates, <span class="at">files =</span>files1) <span class="sc">%&gt;%</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  unique</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in `pivot_longer_spec()`:
! Can't combine `temp` &lt;character&gt; and `temp2` &lt;logical&gt;.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">raw_files =</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"/Users/emmanuelmiller/Desktop/thetext"</span>,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">full.names =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">files =</span> <span class="fu">str_extract</span>(raw_files, <span class="st">"(?&lt;=thetext.).+(?=_Page)"</span>),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">files =</span> <span class="fu">str_remove</span>(files, <span class="st">"edite*d*_*"</span>))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>pdfs1<span class="ot">&lt;-</span> pdfs1 <span class="sc">%&gt;%</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(., temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in full_join(., temp): object 'pdfs1' not found</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pdfs1 <span class="sc">%&gt;%</span> head</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in head(.): object 'pdfs1' not found</code></pre>
</div>
</div>
<p>I made an excel sheet and documented the volume and edition numbers of the books I use. I could extract the metadata using code for this part of the dataset, but for the sake of consistency with the IA dataset, and ensuring correct metadata, I decided to do this portion by hand.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>book_metadata <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/book_metadata.xlsx"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error: `path` does not exist: '/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/book_metadata.xlsx'</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pdfs2<span class="ot">&lt;-</span>pdfs1 <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., book_metadata <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>titles, <span class="sc">-</span>dates, <span class="sc">-</span>type), </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"files"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(titles, dates) <span class="sc">%&gt;%</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(<span class="fu">matches</span>(<span class="st">"edition|volume|part"</span>), <span class="at">.direction =</span> <span class="fu">c</span>(<span class="st">"updown"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  ungroup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in left_join(., book_metadata %&gt;% select(-titles, -dates, -type), : object 'pdfs1' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>pdfs2 <span class="sc">%&gt;%</span> head <span class="sc">%&gt;%</span> kable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in head(.): object 'pdfs2' not found</code></pre>
</div>
</div>
</section>
<section id="internet-archive-data" class="level3">
<h3 class="anchored" data-anchor-id="internet-archive-data">Internet Archive Data</h3>
<p>Like the inter-library loan dataset, I also needed to extract metadata for the files I downloaded. I decided to do this manually because I had not yet finished cleaning the OCR and I wanted to ensure that I didn’t have duplicate books. I found that 4 of the books had incorrect dates and 2 of the books were from before 1875. The only reason why I found metadata for these books was from a note from the library in the back of the book. I decided to carry out metadata-searching manually.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>texts<span class="ot">&lt;-</span> book_metadata <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"ia"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in filter(., type == "ia"): object 'book_metadata' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">###make sure titles match</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># texts&lt;- dat8 %&gt;% </span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(titles, dates, files=hrefs) %&gt;% </span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   right</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">raw_files =</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"/Users/emmanuelmiller/Desktop/text_ia"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">full.names =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">files =</span> <span class="fu">str_extract</span>(raw_files, <span class="st">"(?&lt;=text_ia.).+(?=_Page)"</span>),</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">files =</span> <span class="fu">str_remove</span>(files, <span class="st">"edits_|edite*d*_*"</span>))</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>texts<span class="ot">&lt;-</span> texts <span class="sc">%&gt;%</span> </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(., temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in full_join(., temp): object 'texts' not found</code></pre>
</div>
</div>
<p>I combine both the inter-library loan and the internet archive datasets. This will help me</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># texts %&gt;% names</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># pdfs2 %&gt;% names</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>texts<span class="ot">&lt;-</span> texts <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"ia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in mutate(., type = "ia"): object 'texts' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>pdfs2<span class="ot">&lt;-</span> pdfs2 <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(raw_files, <span class="at">.after=</span> <span class="st">"part"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"ill"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in relocate(., raw_files, .after = "part"): object 'pdfs2' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(texts, pdfs2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in list2(...): object 'texts' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span>dat <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>files) <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(raw_files))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in select(., -files): object 'dat' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bind_rows(texts, pdfs1) %&gt;% </span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(type, files) %&gt;% </span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(type, titles, dates, files) %&gt;%unique %&gt;% </span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   openxlsx::write.xlsx(., file = "temp.xlsx")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally, I added page numbers and read in the files. I saved this because it takes a long time to load in.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">page =</span> <span class="fu">str_extract</span>(raw_files, <span class="st">"(?&lt;=Page_)</span><span class="sc">\\</span><span class="st">d+"</span>),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">page =</span> <span class="fu">as.numeric</span>(page)) </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span>dat <span class="sc">%&gt;%</span> </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span><span class="fu">map</span>(raw_files, <span class="sc">~</span><span class="fu">read_lines</span>(.)))</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(dat, <span class="at">file =</span> <span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/dat.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/dat.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in readChar(con, 5L, useBytes = TRUE): cannot open compressed file '/
Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/
dat.RData', probable reason 'No such file or directory'</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in readChar(con, 5L, useBytes = TRUE): cannot open the connection</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> head </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in head(.): object 'dat' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save(dat, file = "dat.RData")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Because the separator was a new line, there are multiple rows for 1 page. I combine them into 1 page here.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>raw_files) <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">map</span>(dat,<span class="sc">~</span><span class="fu">str_c</span>(., <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in select(., -raw_files): object 'dat' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> tail <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">str_sub</span>(dat, <span class="dv">1</span>, <span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in tail(.): object 'dat' not found</code></pre>
</div>
</div>
</section>
</section>
<section id="cleaning" class="level1">
<h1>Cleaning</h1>
<p>Some of the files in the Internet Archive dataset have a notice from google saying that their copyrights have expired. Because these aren’t part of the actual dataset, I remove them. I also remove empty pages, which I assume were because of some images being printed on one side. It may also be possible that these were censored, but it is unclear. If this were the case, it may affect the accuracy of the conclusions I draw in this pilot study. In a larger work, I would recommend obtaining all books from interlibrary loan as PDFs.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>dat1<span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(dat, <span class="st">"(?i)google"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">str_remove</span>(dat, <span class="st">"^</span><span class="sc">\\</span><span class="st">s+$"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(dat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in filter(., !str_detect(dat, "(?i)google")): object 'dat' not found</code></pre>
</div>
</div>
<p>I noticed that there were many whitespaces on each page. I decided to remove whitespaces since I would like to do sentence-level analyses. I also removed extraneous punctuation. Because I plan to tokenize using the Quanteda package, I will keep some essential punctuation.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>dat1<span class="ot">&lt;-</span> dat1 <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">str_replace_all</span>(dat, <span class="fu">c</span>(</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\\</span><span class="st">t"</span> <span class="ot">=</span> <span class="st">" "</span>,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\\</span><span class="st">n"</span> <span class="ot">=</span> <span class="st">" "</span>,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\\</span><span class="st">r"</span> <span class="ot">=</span> <span class="st">" "</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\\</span><span class="st">|"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span> <span class="ot">=</span> <span class="st">" "</span>,</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">w)</span><span class="sc">\\</span><span class="st">s*-</span><span class="sc">\\</span><span class="st">s*(?=</span><span class="sc">\\</span><span class="st">w)"</span> <span class="ot">=</span> <span class="st">"IWASAHYPHEN"</span>,</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"'"</span> <span class="ot">=</span> <span class="st">"IWASASINGLEQUOTE"</span>,</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\\</span><span class="st">."</span> <span class="ot">=</span> <span class="st">"IWASAPERIOD"</span>,</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>                       <span class="st">","</span> <span class="ot">=</span> <span class="st">"IWASACOMMA"</span>,</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"[[:punct:]]+"</span> <span class="ot">=</span> <span class="st">" "</span>,</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span> <span class="ot">=</span> <span class="st">" "</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>                       )),</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">dat =</span> <span class="fu">str_remove_all</span>(dat, <span class="st">"[^[:alnum:]</span><span class="sc">\\</span><span class="st">s]"</span>),</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">dat =</span> <span class="fu">str_replace_all</span>(dat, <span class="fu">c</span>(</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>           <span class="st">"IWASAHYPHEN"</span> <span class="ot">=</span> <span class="st">"-"</span>,</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>           <span class="st">"IWASAPERIOD"</span> <span class="ot">=</span> <span class="st">"."</span>,</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>           <span class="st">"IWASACOMMA"</span> <span class="ot">=</span> <span class="st">","</span>,</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>           <span class="st">"IWASASINGLEQUOTE"</span> <span class="ot">=</span> <span class="st">"'"</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>         ))</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>                     )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in mutate(., dat = str_replace_all(dat, c(`\\t` = " ", `\\n` = " ", : object 'dat1' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>dat1 <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">str_sub</span>(dat, <span class="dv">1</span>, <span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(titles, dates) <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  kable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in mutate(., dat = str_sub(dat, 1, 100)): object 'dat1' not found</code></pre>
</div>
</div>
<p>I noticed that there are many single characters that are a result of either noise being transcribed or because of images that were transcribed. I remove these single characters and duplicate periods.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>dat1<span class="ot">&lt;-</span> dat1 <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">stri_replace_all_regex</span>(dat, <span class="fu">paste0</span>(<span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">.|</span><span class="sc">\\</span><span class="st">s)"</span>, </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                                                  letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">26</span>],</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"(?=</span><span class="sc">\\</span><span class="st">.|</span><span class="sc">\\</span><span class="st">s)"</span>), <span class="fu">rep</span>(<span class="st">""</span>, <span class="dv">26</span>),</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">vectorize_all =</span> F),</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">dat =</span> <span class="fu">stri_replace_all_regex</span>(dat, <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">b"</span>, </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>                                                  letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">26</span>], </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"</span><span class="sc">\\</span><span class="st">b"</span>), <span class="fu">rep</span>(<span class="st">""</span>, <span class="dv">26</span>),</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">vectorize_all =</span> F)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">stri_replace_all_regex</span>(dat, <span class="fu">paste0</span>(<span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">.|</span><span class="sc">\\</span><span class="st">s)"</span>, </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>                                            LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">26</span>],</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"(?=</span><span class="sc">\\</span><span class="st">.|</span><span class="sc">\\</span><span class="st">s)"</span>), <span class="fu">rep</span>(<span class="st">""</span>, <span class="dv">26</span>),</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">vectorize_all =</span> F), </span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">dat =</span> <span class="fu">stri_replace_all_regex</span>(dat, <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">b"</span>, </span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>                                            LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">26</span>],</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"</span><span class="sc">\\</span><span class="st">b"</span>), <span class="fu">rep</span>(<span class="st">""</span>, <span class="dv">26</span>), </span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">vectorize_all =</span> F)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in mutate(., dat = stri_replace_all_regex(dat, paste0("(?&lt;=\\.|\\s)", : object 'dat1' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>dat1<span class="ot">&lt;-</span>dat1 <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">str_replace_all</span>(dat, <span class="fu">c</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span> <span class="ot">=</span> <span class="st">" "</span>,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"</span><span class="sc">\\</span><span class="st">.+"</span> <span class="ot">=</span> <span class="st">"."</span>,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"(</span><span class="sc">\\</span><span class="st">s?</span><span class="sc">\\</span><span class="st">.)+"</span> <span class="ot">=</span> <span class="st">"."</span>,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"^</span><span class="sc">\\</span><span class="st">s+$"</span> <span class="ot">=</span> <span class="st">""</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                                          )</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>                                 )) <span class="sc">%&gt;%</span> </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(dat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in mutate(., dat = str_replace_all(dat, c(`\\s+` = " ", `\\.+` = ".", : object 'dat1' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>dat1 <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">str_sub</span>(dat, <span class="dv">1</span>, <span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(titles, dates) <span class="sc">%&gt;%</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  ungroup<span class="sc">%&gt;%</span> </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  kable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in mutate(., dat = str_sub(dat, 1, 100)): object 'dat1' not found</code></pre>
</div>
</div>
</section>
<section id="cleaning-using-dictionaries" class="level1">
<h1>Cleaning Using Dictionaries</h1>
<section id="overview-1" class="level3">
<h3 class="anchored" data-anchor-id="overview-1">Overview</h3>
<p>Many pages contain letters that aren’t reflective of the text. This is partly a result of attempting to read diagrams with words or places where there was lots of background noise that couldn’t be removed. Some of the older texts have words that were misspelled. In order to further remove some of these strings of characters, I will use the Hunspell package to check whether a word is misspelled, and if it is, I remove it from the corpus. I will go into this further in the next section and that I will need to take this into consideration if using certain analytical methods such as machine learning. One issue I noticed with this approach is that some words that are in the medical lexicon are marked as misspelled. In order to counter this, I incorporate words from medical books to help with this process.</p>
<p>I used selection criteria as follows. I decided to choose books that have been OCR’d by a human and therefore are more certainly reflective the original text, or if they already came in a text format like epub. For the quantity of books that I use I had to consider the availability of this high-quality OCR data as well as my research question. I am looking at 2 different time periods, pre-1970s and post-1970s, and my corpus is rather small with roughly 30 books per time period. Unfortunately, there are not many well-OCR’d older medical texts widely available on the internet. After speaking with Dr.&nbsp;Song, I decided that I would use 2 books to build this medical dictionary (so 1 book per time period).</p>
<p>I also considered 2 different approaches for getting just medical vocabulary. I first considered tokenizing the whole book, removing stopwords, and using the whole thing as a medical dictionary. I found that using this approach, in combination with fuzzy-matching (which I do later), allowed shorter ~3 letter words which were wrongly transcribed to be marked as “good”. I then considered using only the index of the book. This automatically selects keywords that are reviewed in the text and are primarily related to anatomy or pathology. I decided on the latter approach as it was more stringent and allowed fewer false-positives.</p>
<p>I review the cleaning and application of this method inn 3 sections.</p>
</section>
<section id="pre-1970s-text-acquisition-and-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="pre-1970s-text-acquisition-and-cleaning">Pre-1970’s Text Acquisition and Cleaning</h3>
<p>For the pre-1970s text, I reviewed project Gutenberg because their books have been transcribed by a submitter. I searched “anatomy” and “gynecology”. I considered books only relating to humans and targeted towards the medical profession. I chose “Structure and Functions of The Body” by Annette Fiske, published in 1911. This is one of the few that reviewed vaginal anatomy. Typographical changes were made by the transcriber, which adds a layer of review to this transcriptions.</p>
<p>I decided to webscrape the text file from the Project Gutenberg website as this was less trouble than fighting with the gutenbergr R package or Firefox on downloading the text version.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#make dictionary -- gutenberg</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>polite<span class="sc">::</span><span class="fu">bow</span>(<span class="st">"https://gutenberg.org/files/64754/64754-0.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;polite session&gt; https://gutenberg.org/files/64754/64754-0.txt
    User-agent: polite R package
    robots.txt: 44 rules are defined for 30 bots
   Crawl delay: 5 sec
  The path is scrapable for this user-agent</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>guten<span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">read_html</span>(<span class="st">"https://gutenberg.org/files/64754/64754-0.txt"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  rvest<span class="sc">::</span><span class="fu">html_nodes</span>(.,<span class="at">xpath=</span><span class="st">"/html/body/*"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  rvest<span class="sc">::</span><span class="fu">html_text</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next I select only the index portion of the text and remove extraneous punctuation and words (like “et seq” which is a way to reference page numbers). I also made duplicate words which had both “’s” and without.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>guten1<span class="ot">&lt;-</span><span class="fu">tibble</span>(<span class="at">book =</span> guten) <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">str_extract</span>(book, <span class="st">"(?&lt;=INDEX</span><span class="sc">\\</span><span class="st">.)[</span><span class="sc">\\</span><span class="st">s</span><span class="sc">\\</span><span class="st">S]*(?=SAUNDERS. BOOKS FOR NURSES)"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>book)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>guten2<span class="ot">&lt;-</span> guten1 <span class="sc">%&gt;%</span> </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">str_replace_all</span>(index, <span class="fu">c</span>(<span class="st">".et seq..|.et seq."</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">","</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"æ"</span> <span class="ot">=</span> <span class="st">"ae"</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>                                          ))) <span class="sc">%&gt;%</span> </span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">other0 =</span> <span class="fu">str_extract</span>(index, <span class="st">"</span><span class="sc">\\</span><span class="st">w+(?='s)"</span>),</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">other =</span> <span class="fu">str_remove_all</span>(index, <span class="st">"-"</span>),</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">str_replace_all</span>(., <span class="fu">c</span>(<span class="st">"[:punct:]+"</span><span class="ot">=</span> <span class="st">""</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">values_to =</span> <span class="st">"index"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(index)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(index, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">n"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">trimws</span>(index, <span class="at">which =</span> <span class="st">"both"</span>),</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">nchar =</span> <span class="fu">nchar</span>(index))</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>guten2 <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 2
   index                             nchar
   &lt;chr&gt;                             &lt;int&gt;
 1 ""                                    0
 2 ""                                    0
 3 ""                                    0
 4 "Abdomen"                             7
 5 "muscles"                             7
 6 "nerves"                              6
 7 "regions"                             7
 8 "contents"                            8
 9 "Abdominal aorta"                    15
10 "Abducens nerve"                     14
11 "Abscess"                             7
12 "Absorbent vessels or lymphatics"    31
13 "Absorption of food"                 18
14 "in intestines"                      13
15 "in mouth"                            8
16 "in stomach"                         10
17 "Accommodation of eye"               20
18 "Acetabulum"                         10
19 "Acromion process"                   16
20 "Adams apple"                        11</code></pre>
</div>
</div>
<p>After, I tokenize each word in the index and remove stopwords (such as “of”) from the corpus. I then reviewed words that were 3-4 characters to confirm that they were medically related.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>guten3<span class="ot">&lt;-</span>guten2 <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">tolower</span>(index),</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">index =</span> <span class="fu">str_replace_all</span>(index, <span class="fu">c</span>(<span class="st">"'s"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"'"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">'</span><span class="sc">\\</span><span class="st">"'</span> <span class="ot">=</span> <span class="st">''</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(index, <span class="at">sep =</span> <span class="st">" "</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">trimws</span>(index, <span class="at">which =</span> <span class="st">"both"</span>),</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">nchar =</span> <span class="fu">nchar</span>(index)) <span class="sc">%&gt;%</span> </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(index) <span class="sc">&amp;</span> <span class="sc">!</span>(index <span class="sc">%in%</span> tm<span class="sc">::</span><span class="fu">stopwords</span>()) ) <span class="sc">%&gt;%</span> </span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  unique</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>guten3 <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(nchar) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 2
   index nchar
   &lt;chr&gt; &lt;int&gt;
 1 os        2
 2 eye       3
 3 air       3
 4 arm       3
 5 leg       3
 6 bow       3
 7 hip       3
 8 ear       3
 9 end       3
10 fat       3
11 sac       3
12 pia       3
13 lid       3
14 pus       3
15 red       3
16 sty       3
17 tie       3
18 vas       3
19 wry       3
20 food      4</code></pre>
</div>
</div>
</section>
<section id="post-1970s-text-acquisition-and-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="post-1970s-text-acquisition-and-cleaning">Post 1970’s Text Acquisition and Cleaning</h3>
<p>To acquire a post-1970’s text, I searched “gynecology” and “anatomy” with tags “medical” in the UMass Amherst library catalog. I then searched for “epub” as the format. I chose “Clinically Oriented Anatomy 7th edition” by Keith Moore et al., published in 2014. I converted the epub to a text document using convertio.co (which is a website that I found by googling “epub to txt convert”). I downloaded the converted book and selected only the index.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>moore<span class="ot">&lt;-</span> <span class="fu">read_file</span>(<span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/Keith-L.-Moore-PhD-FIAC-FRSM-FAAA_-Anne-M.-R.-Agur-BSc-_OT_-MSc-PhD_-Arthur-F.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error: '/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/Keith-L.-Moore-PhD-FIAC-FRSM-FAAA_-Anne-M.-R.-Agur-BSc-_OT_-MSc-PhD_-Arthur-F.txt' does not exist.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>moore1<span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">book =</span> moore) <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">str_extract</span>(book, <span class="st">"(?&lt;=Index)</span><span class="sc">\\</span><span class="st">s+A</span><span class="sc">\\</span><span class="st">s+[</span><span class="sc">\\</span><span class="st">s</span><span class="sc">\\</span><span class="st">S]*$"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>book) <span class="sc">%&gt;%</span> </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(index, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">n</span><span class="sc">\\</span><span class="st">n"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(index))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in eval_tidy(xs[[j]], mask): object 'moore' not found</code></pre>
</div>
</div>
<p>Like the pre-1970’s dictionary, I remove punctuation and make both forms of words with “’s” and without.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>moore2<span class="ot">&lt;-</span> moore1 <span class="sc">%&gt;%</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">other0 =</span> <span class="fu">str_extract</span>(index, <span class="st">"</span><span class="sc">\\</span><span class="st">w+(?='s)"</span>),</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">other =</span> <span class="fu">str_remove_all</span>(index, <span class="st">"-"</span>),</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">str_replace_all</span>(., <span class="fu">c</span>(<span class="st">"[:punct:]+"</span><span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span><span class="ot">=</span> <span class="st">""</span>))),</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">tolower</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">values_to =</span> <span class="st">"index"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(index))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in mutate(., other0 = str_extract(index, "\\w+(?='s)"), other = str_remove_all(index, : object 'moore1' not found</code></pre>
</div>
</div>
<p>Finally, I tokenize the index and remove stopwords. I reviewed words that were 2-3 characters long to confirm they were medically related. I found that there are times when French (such as “Le” for “Le Fort fracture”) or acronyms are used (such as “ap” for anteposterior or “pa” posteroanterior). Some were remains of numbering (such as “1st” being “st”). Others were single letters because of being contractions with numbers (“c1”, which is the first cervical vertebra, was converted to “c”) or because single letters were written at the top of each page. I also noticed roman numerals were included because of the numbering of the cranial nerves.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>moore3<span class="ot">&lt;-</span> moore2 <span class="sc">%&gt;%</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(index, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  unique <span class="sc">%&gt;%</span> </span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nchar =</span> <span class="fu">nchar</span>(index))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in separate_rows(., index, sep = "\\s+"): object 'moore2' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>moore3 <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(nchar) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">40</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in arrange(., nchar): object 'moore3' not found</code></pre>
</div>
</div>
<p>I ended up removing words which had fewer than 3 characters because these short words would already be removed with earlier cleaning of the corpus, and because they usually co-occur with more substantive nouns within the index (ex. the whole string containing “c1” was “c1 spine” or “l2 vertebra” meaning the second lumbar vertebra). I also found that short strings in a dictionary tended to lead to false-positive words (that were made by Tesseract misreading grainy pictures).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>moore3<span class="ot">&lt;-</span>moore3 <span class="sc">%&gt;%</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nchar <span class="sc">&gt;</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(index <span class="sc">%in%</span> letters) <span class="sc">&amp;</span> </span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span><span class="fu">is.na</span>(index) <span class="sc">&amp;</span> </span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span>(index <span class="sc">%in%</span> tm<span class="sc">::</span><span class="fu">stopwords</span>()) <span class="sc">&amp;</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span>(index <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"vs"</span>, <span class="fu">tolower</span>(<span class="fu">as.roman</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in filter(., nchar &gt; 2): object 'moore3' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>moore3 <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(nchar) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in arrange(., nchar): object 'moore3' not found</code></pre>
</div>
</div>
<p>I also included a dictionary, the Oxford Concise Color Medical Dictionary, 3rd edition from 2010. I also converted this epub to text using the same converter as above.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>oxford<span class="ot">&lt;-</span><span class="fu">read_file</span>(<span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/Oxford-Quick-Reference-Jonathan.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error: '/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/Oxford-Quick-Reference-Jonathan.txt' does not exist.</code></pre>
</div>
</div>
<p>Like the other 2 examples, words from the index.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>oxford1<span class="ot">&lt;-</span><span class="fu">tibble</span>(<span class="at">dat =</span> oxford) <span class="sc">%&gt;%</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">str_extract</span>(dat, <span class="st">"A &amp; E medicine[</span><span class="sc">\\</span><span class="st">s</span><span class="sc">\\</span><span class="st">S]+zymotic disease(?=</span><span class="sc">\\</span><span class="st">s{4}OXFORD QUICK)"</span>),<span class="co">#</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">index1 =</span> <span class="fu">str_extract</span>(dat, <span class="st">"Affixesabdomin.[</span><span class="sc">\\</span><span class="st">s</span><span class="sc">\\</span><span class="st">S]+(?=a- </span><span class="sc">\\</span><span class="st">(an-</span><span class="sc">\\</span><span class="st">) prefix)"</span>),</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">index1 =</span> <span class="fu">str_replace</span>(dat, <span class="st">"Affixesabdomin"</span>, <span class="st">"Affixes </span><span class="sc">\n\n</span><span class="st">abdomin"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>dat) <span class="sc">%&gt;%</span> </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">values_to =</span> <span class="st">"index"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">str_split</span>(index, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(index) <span class="sc">%&gt;%</span> </span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(index))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in eval_tidy(xs[[j]], mask): object 'oxford' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>oxford1<span class="ot">&lt;-</span>oxford1 <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">14</span><span class="sc">:</span> <span class="fu">nrow</span>(oxford1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in slice(., 14:nrow(oxford1)): object 'oxford1' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>oxford1 <span class="sc">%&gt;%</span> head</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in head(.): object 'oxford1' not found</code></pre>
</div>
</div>
<p>I retrieved some affixes and abbreviations included here. I chose to remove them from the subset of words I’ll use for the dictionary because with the fuzzy matching they match words that are from white noise on the page.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>oxford_affix<span class="ot">&lt;-</span> oxford1 <span class="sc">%&gt;%</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(index, <span class="st">"^-</span><span class="sc">\\</span><span class="st">w+$|^</span><span class="sc">\\</span><span class="st">w+-$"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in filter(., str_detect(index, "^-\\w+$|^\\w+-$")): object 'oxford1' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>oxford_abbrev <span class="ot">&lt;-</span> oxford1 <span class="sc">%&gt;%</span> </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index2 =</span> <span class="fu">str_split</span>(index, <span class="st">"[[:punct:]</span><span class="sc">\\</span><span class="st">s]+"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(index2) <span class="sc">%&gt;%</span> </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(index2, <span class="st">"^[[:upper:]]{2,}$"</span>) <span class="sc">&amp;</span> </span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span>(index2 <span class="sc">%in%</span> <span class="fu">as.roman</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in mutate(., index2 = str_split(index, "[[:punct:]\\s]+")): object 'oxford1' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>oxford2<span class="ot">&lt;-</span> oxford1 <span class="sc">%&gt;%</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(.,oxford_abbrev) <span class="sc">%&gt;%</span> </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(index, <span class="st">"^-</span><span class="sc">\\</span><span class="st">w+$|^</span><span class="sc">\\</span><span class="st">w+-$"</span>) <span class="sc">&amp;</span> </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">is.na</span>(index2)) <span class="sc">%&gt;%</span> </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>index2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in left_join(., oxford_abbrev): object 'oxford1' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>oxford2 <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in slice(., 10:15): object 'oxford2' not found</code></pre>
</div>
</div>
<p>Like previously, I make multiple matching for possesive nouns.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>oxford2<span class="ot">&lt;-</span> oxford2 <span class="sc">%&gt;%</span> </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">other0 =</span> <span class="fu">str_extract</span>(index, <span class="st">"</span><span class="sc">\\</span><span class="st">w+(?='s)"</span>),</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">other =</span> <span class="fu">str_replace_all</span>(index, <span class="st">"[[:punct:]]"</span>, <span class="st">" "</span>),</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">str_replace_all</span>(., <span class="fu">c</span>(<span class="st">"[:punct:]+"</span><span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span><span class="ot">=</span> <span class="st">""</span>))),</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">tolower</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">values_to =</span> <span class="st">"index"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(index)) <span class="sc">%&gt;%</span> unique</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in mutate(., other0 = str_extract(index, "\\w+(?='s)"), other = str_replace_all(index, : object 'oxford2' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>oxford2 <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in slice(., 10:15): object 'oxford2' not found</code></pre>
</div>
</div>
<p>finally I remove stop words and roman numerials and strings shorter than 2 characters (for the same reason as before).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>oxford3<span class="ot">&lt;-</span> oxford2 <span class="sc">%&gt;%</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(index, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  unique <span class="sc">%&gt;%</span> </span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nchar =</span> <span class="fu">nchar</span>(index))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in separate_rows(., index, sep = "\\s+"): object 'oxford2' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>oxford3<span class="ot">&lt;-</span>oxford3 <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nchar <span class="sc">&gt;</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(index <span class="sc">%in%</span> letters) <span class="sc">&amp;</span> </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span><span class="fu">is.na</span>(index) <span class="sc">&amp;</span> </span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span>(index <span class="sc">%in%</span> tm<span class="sc">::</span><span class="fu">stopwords</span>()) <span class="sc">&amp;</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span>(index <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"vs"</span>, <span class="fu">tolower</span>(<span class="fu">as.roman</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in filter(., nchar &gt; 2): object 'oxford3' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>oxford3 <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in slice(., 10:15): object 'oxford3' not found</code></pre>
</div>
</div>
</section>
<section id="applying-dictionaries" class="level3">
<h3 class="anchored" data-anchor-id="applying-dictionaries">Applying Dictionaries</h3>
<p>In order to apply the dictionary, I first tokenize my corpus and save the tokens as a vector. I found that using vectors is faster than using a tibble.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>dat2<span class="ot">&lt;-</span> dat1 <span class="sc">%&gt;%</span> </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">strsplit</span>(dat, <span class="st">"."</span>, <span class="at">fixed =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(dat) <span class="sc">%&gt;%</span> </span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  tidytext<span class="sc">::</span><span class="fu">unnest_tokens</span>(., <span class="st">"tokens"</span>, dat, </span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">token =</span> <span class="st">"words"</span>, </span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">format =</span> <span class="st">"text"</span>,</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">drop =</span> F) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in mutate(., dat = strsplit(dat, ".", fixed = T)): object 'dat1' not found</code></pre>
</div>
</div>
<p>Next I make a separate table where words can be checked against US, Australian, Canadian, and UK English dictionaries. I also make a medical dictionary comprised of the texts from the 2 timepoints and add it to the main dictionary.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span> <span class="fu">unique</span>(dat2<span class="sc">$</span>tokens)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in unique(dat2$tokens): object 'dat2' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hunspell::list_dictionaries()</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>dicts<span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">value =</span> temp,</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">en_us =</span> <span class="fu">hunspell_check</span>(temp, </span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">dict =</span> hunspell<span class="sc">::</span><span class="fu">dictionary</span>(<span class="st">"en_US"</span>)), </span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">en_au =</span> <span class="fu">hunspell_check</span>(temp, <span class="at">dict =</span> </span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>                                       hunspell<span class="sc">::</span><span class="fu">dictionary</span>(<span class="st">"en_AU"</span>)),</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">en_ca =</span> <span class="fu">hunspell_check</span>(temp, <span class="at">dict =</span> </span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>                                       hunspell<span class="sc">::</span><span class="fu">dictionary</span>(<span class="st">"en_CA"</span>)),</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">en_gb =</span> <span class="fu">hunspell_check</span>(temp, <span class="at">dict =</span> </span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>                                       hunspell<span class="sc">::</span><span class="fu">dictionary</span>(<span class="st">"en_GB"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in hunspell_check(temp, dict = hunspell::dictionary("en_US")): is.character(words) is not TRUE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>med_dict<span class="ot">&lt;-</span> <span class="fu">rbind</span>(guten3, moore3, oxford3) <span class="sc">%&gt;%</span> </span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>nchar, <span class="at">value =</span> index) <span class="sc">%&gt;%</span> </span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  unique</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in rbind(deparse.level, ...): object 'moore3' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>dicts1<span class="ot">&lt;-</span> dicts <span class="sc">%&gt;%</span> </span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., med_dict <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">med =</span><span class="st">"med"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in left_join(., med_dict %&gt;% mutate(med = "med")): object 'dicts' not found</code></pre>
</div>
</div>
<p>I first get a snapshot of the number of words that were marked as “good” by both the medical dictionaries and by hunspell. There are 3x more words that don’t match the dictionaries than words that do.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>dicts2<span class="ot">&lt;-</span> dicts1 <span class="sc">%&gt;%</span> </span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">med =</span> <span class="sc">!</span><span class="fu">is.na</span>(med)) <span class="sc">%&gt;%</span> </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(rowid, value), <span class="at">values_to =</span> <span class="st">"dict_sum"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">good =</span> <span class="fu">ifelse</span>(<span class="fu">any</span>(dict_sum), <span class="st">"yes"</span>, <span class="st">"no"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>  ungroup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in mutate(., med = !is.na(med)): object 'dicts1' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>dicts2 <span class="sc">%&gt;%</span> <span class="fu">count</span>(good)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in count(., good): object 'dicts2' not found</code></pre>
</div>
</div>
</section>
<section id="medical-dictionaries-fuzzy-join" class="level3">
<h3 class="anchored" data-anchor-id="medical-dictionaries-fuzzy-join">Medical Dictionaries: Fuzzy Join</h3>
<p>In order to use fuzzy matching, I need to reduce the amount of time the algorithm takes because otherwise my computer crashes. One way I do this is by filtering a certain length of word. I first looked at the overall distribution of character lengths.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fuzzyjoin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in library(fuzzyjoin): there is no package called 'fuzzyjoin'</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>foo0<span class="ot">&lt;-</span> dicts2 <span class="sc">%&gt;%</span> </span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(value, good) <span class="sc">%&gt;%</span> </span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nchar =</span> <span class="fu">nchar</span>(value))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in select(., value, good): object 'dicts2' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>foo0 <span class="sc">%&gt;%</span> <span class="fu">pull</span>(nchar) <span class="sc">%&gt;%</span> log <span class="sc">%&gt;%</span> <span class="fu">hist</span>(., <span class="at">xlab =</span> <span class="st">"log(letters)"</span>, </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">main =</span> <span class="st">"Histogram of log(Letters) per Token"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in pull(., nchar): object 'foo0' not found</code></pre>
</div>
</div>
<p>I found that some of my words were just strings of characters. After discovering this and reviewing different lengths, I decided on a cutoff of 29 as there seemed to be no real words left in there.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>foo0 <span class="sc">%&gt;%</span> </span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nchar <span class="sc">&gt;</span><span class="dv">29</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(nchar)) <span class="sc">%&gt;%</span> </span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>  kable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in filter(., nchar &gt; 29): object 'foo0' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>foo<span class="ot">&lt;-</span>foo0<span class="sc">%&gt;%</span> </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(good <span class="sc">==</span> <span class="st">"no"</span> <span class="sc">&amp;</span> nchar <span class="sc">&lt;</span><span class="dv">29</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in filter(., good == "no" &amp; nchar &lt; 29): object 'foo0' not found</code></pre>
</div>
</div>
<p>In order to join, I used the Longest Common Substring algorithm. this measures the number of characters you would need to add or delete to make 2 strings match. What is special about this algorithm compared to others is that it takes into account the order of the characters matched. This is important because many of my strings will have only 1 character misspelled, and the remainder of the word is the same. I also wanted to extra-penalize substitutions, and this gave a stronger selection than Levenshtein distance. I chose 2 because that gives room for either a substitution, 2 deletions, or 2 additions. I used this to join the medical dictionary.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>joining <span class="ot">&lt;-</span> <span class="cf">function</span>(df, dict){</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  df<span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stringdist_left_join</span>(., dict, </span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">method =</span> <span class="st">"lcs"</span>, </span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">distance_col =</span> <span class="st">"dist"</span>,</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">max_dist =</span> <span class="dv">2</span>)</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>corrections<span class="ot">&lt;-</span>foo <span class="sc">%&gt;%</span> </span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nchar <span class="sc">&gt;=</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nchar) <span class="sc">%&gt;%</span> </span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_split</span>()</span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a>corrections<span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(corrections, <span class="sc">~</span><span class="fu">joining</span>(.x, med_dict))</span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a><span class="co"># save(corrections, file="/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/medcorrections.RData")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I then counted the number of matches to the original value, and how many matches were at a given distance.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/medcorrections.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in readChar(con, 5L, useBytes = TRUE): cannot open compressed file '/
Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/
medcorrections.RData', probable reason 'No such file or directory'</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in readChar(con, 5L, useBytes = TRUE): cannot open the connection</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>corrections1<span class="ot">&lt;-</span> corrections <span class="sc">%&gt;%</span> </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(value.x, <span class="at">name =</span> <span class="st">"n_matches"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(value.x, dist, <span class="at">name =</span> <span class="st">"n_matches_at_dist"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in add_count(., value.x, name = "n_matches"): object 'corrections' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>corrections1 <span class="sc">%&gt;%</span> </span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(n_matches, dist, n_matches_at_dist, <span class="fu">is.na</span>(value.y)) <span class="sc">%&gt;%</span> </span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  kable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in count(., n_matches, dist, n_matches_at_dist, is.na(value.y)): object 'corrections1' not found</code></pre>
</div>
</div>
<p>In order to choose the best replacement word, I chose words with only 1 match, or if there were multiple options, only the word at the shortest distance. I then added these changes to the collection of tokens as “changeme”.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>corrections2<span class="ot">&lt;-</span> corrections1 <span class="sc">%&gt;%</span> </span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">keep =</span> <span class="fu">case_when</span>(</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>    n_matches <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(dist) <span class="sc">~</span> <span class="st">"yes"</span>,</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>    dist <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> n_matches_at_dist <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"yes"</span>,</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>    T<span class="sc">~</span><span class="st">"no"</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(keep <span class="sc">==</span> <span class="st">"yes"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">value =</span> value.x, value.y) <span class="sc">%&gt;%</span> </span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>  unique</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in mutate(., keep = case_when(n_matches == 1 &amp; !is.na(dist) ~ "yes", : object 'corrections1' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>dicts3<span class="ot">&lt;-</span> dicts2 <span class="sc">%&gt;%</span> </span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(value, good) <span class="sc">%&gt;%</span> </span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>  unique</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in select(., value, good): object 'dicts2' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>dicts3<span class="ot">&lt;-</span> dicts3 <span class="sc">%&gt;%</span> </span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., corrections2) <span class="sc">%&gt;%</span> </span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">good =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(value.y.y), <span class="st">"changeme"</span>, good))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in left_join(., corrections2): object 'dicts3' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>dicts3 <span class="sc">%&gt;%</span> <span class="fu">count</span>(good)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in count(., good): object 'dicts3' not found</code></pre>
</div>
</div>
<p>At this point I realized that words above 25 characters weren’t actually words so I removed them if they weren’t recognized as words in the first place.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>dicts4<span class="ot">&lt;-</span> dicts3 <span class="sc">%&gt;%</span> </span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nchar =</span> <span class="fu">nchar</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(nchar <span class="sc">&gt;</span> <span class="dv">25</span> <span class="sc">&amp;</span> good <span class="sc">==</span> <span class="st">"no"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in mutate(., nchar = nchar(value)): object 'dicts3' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>dicts4 <span class="sc">%&gt;%</span> <span class="fu">count</span>(good)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in count(., good): object 'dicts4' not found</code></pre>
</div>
</div>
</section>
<section id="hunspell-dictionary-stringdist" class="level3">
<h3 class="anchored" data-anchor-id="hunspell-dictionary-stringdist">Hunspell Dictionary: Stringdist</h3>
<p>This next part was a lot more difficult because hunspell takes a lot longer than just fuzzy joining. I first looked at the distribution of the remaining mispelled characters.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>morefoo<span class="ot">&lt;-</span> dicts4 <span class="sc">%&gt;%</span> </span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(value, good) <span class="sc">%&gt;%</span> </span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nchar =</span> <span class="fu">nchar</span>(value))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in select(., value, good): object 'dicts4' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>morefoo1<span class="ot">&lt;-</span>morefoo<span class="sc">%&gt;%</span> </span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(good <span class="sc">==</span> <span class="st">"no"</span> <span class="sc">&amp;</span> nchar <span class="sc">&lt;</span><span class="dv">14</span> <span class="sc">&amp;</span> nchar <span class="sc">&gt;</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in filter(., good == "no" &amp; nchar &lt; 14 &amp; nchar &gt; 3): object 'morefoo' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>morefoo<span class="sc">%&gt;%</span> <span class="fu">count</span>(nchar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in count(., nchar): object 'morefoo' not found</code></pre>
</div>
</div>
<p>As strings get longer, it takes hunspell much longer to parse them. Words under 4 characters were less accurately matched. I decided to use a range from 4-14 for the first round (as this takes a long time to process). I selected the first word from hunspell’s recommended words since that was the best estimate of what the word could have meant.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this function is taken from https://stackoverflow.com/questions/3318333/split-a-vector-into-chunks</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>chunk <span class="ot">&lt;-</span> <span class="cf">function</span>(x, n) <span class="fu">split</span>(x, <span class="fu">sort</span>(<span class="fu">rank</span>(x) <span class="sc">%%</span> n))</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span> morefoo1 <span class="sc">%&gt;%</span> </span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span>  </span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">chunk</span>(., <span class="at">n =</span> <span class="dv">84</span>)</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>hunspell_function<span class="ot">&lt;-</span> <span class="cf">function</span>(wordlist){</span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>  wah<span class="ot">&lt;-</span> <span class="fu">hunspell_suggest</span>(wordlist)</span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>  wee<span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">value =</span> wordlist,</span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">sugg =</span> wah) <span class="sc">%&gt;%</span> </span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_longer</span>(sugg) <span class="sc">%&gt;%</span> </span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a>  ungroup</span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(wee)</span>
<span id="cb149-19"><a href="#cb149-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb149-20"><a href="#cb149-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-21"><a href="#cb149-21" aria-hidden="true" tabindex="-1"></a>weeha<span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(temp, <span class="sc">~</span>{</span>
<span id="cb149-22"><a href="#cb149-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"hmm"</span>)</span>
<span id="cb149-23"><a href="#cb149-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hunspell_function</span>(.x)</span>
<span id="cb149-24"><a href="#cb149-24" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb149-25"><a href="#cb149-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-26"><a href="#cb149-26" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(weeha, <span class="at">file =</span> <span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/hunspellcorrections.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next I did values in the upper ranges.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>morefoo1<span class="ot">&lt;-</span>morefoo<span class="sc">%&gt;%</span> </span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(good <span class="sc">==</span> <span class="st">"no"</span> <span class="sc">&amp;</span> nchar <span class="sc">&gt;</span> <span class="dv">14</span> )</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span> morefoo1 <span class="sc">%&gt;%</span> </span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span>  </span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">chunk</span>(., <span class="at">n =</span> <span class="dv">2</span>)</span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>upper<span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(temp, <span class="sc">~</span>{</span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"hmm"</span>)</span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hunspell_function</span>(.x)</span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-14"><a href="#cb150-14" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(upper, <span class="at">file =</span> <span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/hunspellcorrections_upper.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/hunspellcorrections_upper.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in readChar(con, 5L, useBytes = TRUE): cannot open compressed file '/
Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/
hunspellcorrections_upper.RData', probable reason 'No such file or directory'</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in readChar(con, 5L, useBytes = TRUE): cannot open the connection</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/hunspellcorrections.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in readChar(con, 5L, useBytes = TRUE): cannot open compressed file '/
Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/
hunspellcorrections.RData', probable reason 'No such file or directory'</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in readChar(con, 5L, useBytes = TRUE): cannot open the connection</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>upper <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in head(.): object 'upper' not found</code></pre>
</div>
</div>
<p>I then used stringdist to calculate the LCS distance of each suggestion.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>weeha1<span class="ot">&lt;-</span> weeha <span class="sc">%&gt;%</span> </span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(., upper)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in list2(...): object 'weeha' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>weeha2<span class="ot">&lt;-</span> weeha1 <span class="sc">%&gt;%</span> </span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> stringdist<span class="sc">::</span><span class="fu">stringdist</span>(value, sugg, </span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">method =</span> <span class="st">"lcs"</span></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>                           ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in mutate(., dist = stringdist::stringdist(value, sugg, method = "lcs")): object 'weeha1' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># weeha1 %&gt;% filter(dist == 3) %&gt;% View</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>weeha2 <span class="sc">%&gt;%</span> <span class="fu">count</span>(dist) <span class="sc">%&gt;%</span> head</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in count(., dist): object 'weeha2' not found</code></pre>
</div>
</div>
<p>I decided to remain consistent with earlier datasets and only use a distance of 2.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>weeha3<span class="ot">&lt;-</span> weeha2 <span class="sc">%&gt;%</span> </span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dist <span class="sc">&lt;</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in filter(., dist &lt; 3): object 'weeha2' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>weeha3 <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(value)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in arrange(., desc(value)): object 'weeha3' not found</code></pre>
</div>
</div>
<p>I next added it to the dictionary.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>dicts5<span class="ot">&lt;-</span>dicts4 <span class="sc">%&gt;%</span> </span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., weeha3) <span class="sc">%&gt;%</span> </span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">good =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(sugg), <span class="st">"changeme1"</span>, good))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in left_join(., weeha3): object 'dicts4' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>dicts5 <span class="sc">%&gt;%</span> <span class="fu">count</span>(good)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in count(., good): object 'dicts5' not found</code></pre>
</div>
</div>
<p>Lastly, I decided to see how many words contained medical affixes that I obtained from the Oxford dictionary. I used regex_join to see if any matched.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>tempo<span class="ot">&lt;-</span> oxford_affix <span class="sc">%&gt;%</span> </span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(index) <span class="sc">&gt;</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">trimws</span>(index, <span class="at">which=</span><span class="st">"both"</span>),</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">index =</span> <span class="fu">str_replace_all</span>(index, <span class="fu">c</span>(<span class="st">"^-"</span> <span class="ot">=</span> <span class="st">"^"</span>,</span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"-$"</span> <span class="ot">=</span> <span class="st">".{0,3}$"</span>)),</span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">matches =</span> <span class="st">"yes"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>  unique <span class="sc">%&gt;%</span> </span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">value =</span> index)</span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a>fee<span class="ot">&lt;-</span> dicts5 <span class="sc">%&gt;%</span> </span>
<span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(good <span class="sc">==</span> <span class="st">"no"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb173-12"><a href="#cb173-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(value)</span>
<span id="cb173-13"><a href="#cb173-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-14"><a href="#cb173-14" aria-hidden="true" tabindex="-1"></a>fee1<span class="ot">&lt;-</span> <span class="fu">regex_left_join</span>(fee, tempo)</span>
<span id="cb173-15"><a href="#cb173-15" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(fee1, <span class="at">file=</span><span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/affixes.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I use this as a way of stemming and I replace the word with it. I assume that the stem captures part of the meaning of the original word, and stemming will be done anyway for the word cloud. I couldn’t use hunspell as a stemmer because it kept producing NAs so this is the only way that I thought I could for these words.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/affixes.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in readChar(con, 5L, useBytes = TRUE): cannot open compressed file '/
Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/
affixes.RData', probable reason 'No such file or directory'</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in readChar(con, 5L, useBytes = TRUE): cannot open the connection</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>fee2<span class="ot">&lt;-</span> fee1 <span class="sc">%&gt;%</span> </span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(matches)) <span class="sc">%&gt;%</span> </span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">value =</span> value.x, <span class="at">repl =</span> value.y) <span class="sc">%&gt;%</span> </span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">repl =</span> <span class="fu">str_remove_all</span>(repl, <span class="st">"^|</span><span class="sc">\\</span><span class="st">.[[:punct:]]</span><span class="sc">\\</span><span class="st">d</span><span class="sc">\\</span><span class="st">,</span><span class="sc">\\</span><span class="st">d.."</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in filter(., !is.na(matches)): object 'fee1' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>fee1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(matches)) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in filter(., !is.na(matches)): object 'fee1' not found</code></pre>
</div>
</div>
<p>Next, I add these stems to the dictionary and create a column of replacements. I also remove words that are 2-3 letters long because of reasons I mentioned previosly. Only a few thousand are removed.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>dicts6<span class="ot">&lt;-</span> dicts5 <span class="sc">%&gt;%</span> </span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(fee2) <span class="sc">%&gt;%</span> </span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">good =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(repl), <span class="st">"changeme2"</span>, good))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in left_join(., fee2): object 'dicts5' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>dicts6<span class="ot">&lt;-</span>dicts6 <span class="sc">%&gt;%</span> </span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nchar =</span> <span class="fu">nchar</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">change =</span> <span class="fu">case_when</span>(</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>    good <span class="sc">==</span> <span class="st">"yes"</span> <span class="sc">~</span> value,</span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>    good <span class="sc">==</span> <span class="st">"changeme"</span><span class="sc">~</span> value.y.y,</span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>    good <span class="sc">==</span> <span class="st">"changeme1"</span> <span class="sc">~</span> sugg,</span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a>    good <span class="sc">==</span> <span class="st">"changeme2"</span> <span class="sc">~</span> repl,</span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>    nchar <span class="sc">==</span><span class="dv">2</span> <span class="sc">&amp;</span> <span class="sc">!</span>(value <span class="sc">%in%</span> tm<span class="sc">::</span><span class="fu">stopwords</span>()) <span class="sc">~</span> <span class="cn">NA_character_</span>,</span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a>    T <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">tokens =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(tokens, change)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in mutate(., nchar = nchar(value)): object 'dicts6' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>dicts5 <span class="sc">%&gt;%</span> </span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nchar =</span> <span class="fu">nchar</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">foo=</span>(nchar <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>) <span class="sc">&amp;</span> good <span class="sc">==</span> <span class="st">"no"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in mutate(., nchar = nchar(value)): object 'dicts5' not found</code></pre>
</div>
</div>
<p>Finally, I use the dictionary I made in order to clean the corpus. Below are examples of cleaned lines.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>dat3<span class="ot">&lt;-</span> dat2 <span class="sc">%&gt;%</span> </span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(., dicts6) <span class="sc">%&gt;%</span> </span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(change)) <span class="sc">%&gt;%</span> </span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(titles, dates, edition, volume, part, type, page, dat) <span class="sc">%&gt;%</span></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">temp =</span> <span class="fu">paste0</span>(<span class="fu">na.omit</span>(change), <span class="at">collapse =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>  ungroup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in inner_join(., dicts6): object 'dat2' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save(dat3, file = "/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/dat3.RData")</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>dat3 <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">110</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in slice(., 100:110): object 'dat3' not found</code></pre>
</div>
</div>
</section>
</section>
<section id="word-cloud" class="level1">
<h1>Word Cloud</h1>
<p>In order to visualize my results, I remove stop words and stem.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Package version: 3.2.3
Unicode version: 13.0
ICU version: 69.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Parallel computing: 8 of 8 threads used.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>See https://quanteda.io for tutorials and examples.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'quanteda'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:hunspell':

    dictionary</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textplots)</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>hmm<span class="ot">&lt;-</span> <span class="fu">corpus</span>(dat3<span class="sc">$</span>temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in corpus(dat3$temp): object 'dat3' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">docvars</span>(hmm)<span class="ot">&lt;-</span> dat3 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>dat, <span class="sc">-</span>temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in select(., -dat, -temp): object 'dat3' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>hmm_tok<span class="ot">&lt;-</span> <span class="fu">tokens</span>(hmm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in tokens(hmm): object 'hmm' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>hmm_tok0<span class="ot">&lt;-</span><span class="fu">tokens_remove</span>(hmm_tok, <span class="at">pattern =</span> <span class="fu">stopwords</span>(<span class="st">"en"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in tokens_select(x, ..., selection = "remove"): object 'hmm_tok' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>hmm_tok0<span class="ot">&lt;-</span><span class="fu">tokens_remove</span>(hmm_tok0, <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">"fig"</span>, <span class="st">"et"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in tokens_select(x, ..., selection = "remove"): object 'hmm_tok0' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>hmm_tok1 <span class="ot">&lt;-</span> <span class="fu">tokens_wordstem</span>(hmm_tok0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in tokens_wordstem(hmm_tok0): object 'hmm_tok0' not found</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>hmm_dfm<span class="ot">&lt;-</span> <span class="fu">dfm</span>(hmm_tok1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in dfm(hmm_tok1): object 'hmm_tok1' not found</code></pre>
</div>
</div>
<p>Below is a wordcloud of my whole corpus. I notice that the word “may” is one of the most frequent. This is likely because “may” indicates uncertainty and is frequently used in scientific publications. For this reason, I don’t necessarily consider it a stopword.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_wordcloud</span>(hmm_dfm, <span class="at">max_words =</span> <span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in textplot_wordcloud(hmm_dfm, max_words = 50): object 'hmm_dfm' not found</code></pre>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="DACSS/Text_as_Data_Fall_2022" data-repo-id="R_kgDOH5675w" data-category="Announcements" data-category-id="" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb213" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Blog Post 3: Preprocessing Medical Textbooks"</span></span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Emily Miller"</span></span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a><span class="an">desription:</span><span class="co"> "Processing medical textbooks and visuallizing using word clouds."</span></span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "10/16/2022"</span></span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb213-9"><a href="#cb213-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb213-10"><a href="#cb213-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb213-11"><a href="#cb213-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb213-12"><a href="#cb213-12" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb213-13"><a href="#cb213-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - hw3</span></span>
<span id="cb213-14"><a href="#cb213-14" aria-hidden="true" tabindex="-1"></a><span class="co">  - blogpost3</span></span>
<span id="cb213-15"><a href="#cb213-15" aria-hidden="true" tabindex="-1"></a><span class="co">  - Emily Miller</span></span>
<span id="cb213-16"><a href="#cb213-16" aria-hidden="true" tabindex="-1"></a><span class="co">  - internetarchivebooks</span></span>
<span id="cb213-17"><a href="#cb213-17" aria-hidden="true" tabindex="-1"></a><span class="co">  - internetarchive</span></span>
<span id="cb213-18"><a href="#cb213-18" aria-hidden="true" tabindex="-1"></a><span class="co">  - tidyverse</span></span>
<span id="cb213-19"><a href="#cb213-19" aria-hidden="true" tabindex="-1"></a><span class="co">  - tidytext</span></span>
<span id="cb213-20"><a href="#cb213-20" aria-hidden="true" tabindex="-1"></a><span class="co">  - stringdist</span></span>
<span id="cb213-21"><a href="#cb213-21" aria-hidden="true" tabindex="-1"></a><span class="co">  - fuzzyjoin</span></span>
<span id="cb213-22"><a href="#cb213-22" aria-hidden="true" tabindex="-1"></a><span class="co">  - quanteda</span></span>
<span id="cb213-23"><a href="#cb213-23" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb213-24"><a href="#cb213-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-25"><a href="#cb213-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include = F}</span></span>
<span id="cb213-26"><a href="#cb213-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-27"><a href="#cb213-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb213-28"><a href="#cb213-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb213-29"><a href="#cb213-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr) </span>
<span id="cb213-30"><a href="#cb213-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb213-31"><a href="#cb213-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(polite)</span>
<span id="cb213-32"><a href="#cb213-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringi)</span>
<span id="cb213-33"><a href="#cb213-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb213-34"><a href="#cb213-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hunspell)</span>
<span id="cb213-35"><a href="#cb213-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-36"><a href="#cb213-36" aria-hidden="true" tabindex="-1"></a><span class="co"># save(dat1, guten3, moore3, oxford3, file = "/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/savepoint.RData")</span></span>
<span id="cb213-37"><a href="#cb213-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-38"><a href="#cb213-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-39"><a href="#cb213-39" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-40"><a href="#cb213-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-41"><a href="#cb213-41" aria-hidden="true" tabindex="-1"></a><span class="fu"># Recap</span></span>
<span id="cb213-42"><a href="#cb213-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-43"><a href="#cb213-43" aria-hidden="true" tabindex="-1"></a>**Questions:**</span>
<span id="cb213-44"><a href="#cb213-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-45"><a href="#cb213-45" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Is there a difference in language use between penises and vulvas?</span>
<span id="cb213-46"><a href="#cb213-46" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Is there a change in language use over time?</span>
<span id="cb213-47"><a href="#cb213-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-48"><a href="#cb213-48" aria-hidden="true" tabindex="-1"></a>**How:** Compare language use in anatomy textbooks</span>
<span id="cb213-49"><a href="#cb213-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-50"><a href="#cb213-50" aria-hidden="true" tabindex="-1"></a><span class="fu"># Overview</span></span>
<span id="cb213-51"><a href="#cb213-51" aria-hidden="true" tabindex="-1"></a>This blog post goes over the steps I take to clean my dataset and visualize my work. Because I had to go through so many steps for the initial cleaning, I decided to dedicate a blog post to it. I follow generally the following outline:</span>
<span id="cb213-52"><a href="#cb213-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-53"><a href="#cb213-53" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Dataset initial cleaning, where I remove punctuation and extra characters</span>
<span id="cb213-54"><a href="#cb213-54" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Cleaning using dictionaries that I build from book indexes</span>
<span id="cb213-55"><a href="#cb213-55" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>Hunspell for identifying mispelled words</span>
<span id="cb213-56"><a href="#cb213-56" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Visualizing with a word cloud</span>
<span id="cb213-57"><a href="#cb213-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-58"><a href="#cb213-58" aria-hidden="true" tabindex="-1"></a><span class="fu"># Dataset Initial Cleaning</span></span>
<span id="cb213-59"><a href="#cb213-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-60"><a href="#cb213-60" aria-hidden="true" tabindex="-1"></a><span class="fu">### PDFs from the Inter-library Loan</span></span>
<span id="cb213-61"><a href="#cb213-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-62"><a href="#cb213-62" aria-hidden="true" tabindex="-1"></a>I downloaded a number of other books that I couldn't retrieve from the Internet Archive through UMass's Internlibrary Loan system. Most of the metadata (title, dates) are contained in the filenames of the PDFs, so I add this information in the code below.</span>
<span id="cb213-63"><a href="#cb213-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-66"><a href="#cb213-66" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-67"><a href="#cb213-67" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">raw_files =</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/unabsorbed_pdfs"</span>))</span>
<span id="cb213-68"><a href="#cb213-68" aria-hidden="true" tabindex="-1"></a><span class="co">#add information about the dates of the files where the file doesn't describe it</span></span>
<span id="cb213-69"><a href="#cb213-69" aria-hidden="true" tabindex="-1"></a>pdfs<span class="ot">&lt;-</span> temp <span class="sc">%&gt;%</span> </span>
<span id="cb213-70"><a href="#cb213-70" aria-hidden="true" tabindex="-1"></a>  rowwise <span class="sc">%&gt;%</span> </span>
<span id="cb213-71"><a href="#cb213-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">files =</span> <span class="fu">str_remove_all</span>(raw_files, <span class="st">"_"</span>),</span>
<span id="cb213-72"><a href="#cb213-72" aria-hidden="true" tabindex="-1"></a>         <span class="at">files =</span> <span class="fu">str_replace_all</span>(files, <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>, <span class="st">"_"</span>),</span>
<span id="cb213-73"><a href="#cb213-73" aria-hidden="true" tabindex="-1"></a>         <span class="at">dates =</span> <span class="fu">str_extract</span>(files, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">()</span><span class="sc">\\</span><span class="st">d{4}(?=</span><span class="sc">\\</span><span class="st">))"</span>),</span>
<span id="cb213-74"><a href="#cb213-74" aria-hidden="true" tabindex="-1"></a>         <span class="at">dates =</span> <span class="fu">as.numeric</span>(dates)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-75"><a href="#cb213-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dates =</span> <span class="fu">case_when</span>(</span>
<span id="cb213-76"><a href="#cb213-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(files, <span class="st">"Advances_in_Anatomy,_Embryology"</span>) <span class="sc">~</span> <span class="dv">2004</span>,</span>
<span id="cb213-77"><a href="#cb213-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(files, <span class="st">"</span><span class="sc">\\</span><span class="st">(Current_Clinical_Urology"</span>)<span class="sc">~</span> <span class="dv">2007</span>,</span>
<span id="cb213-78"><a href="#cb213-78" aria-hidden="true" tabindex="-1"></a>    T<span class="sc">~</span>dates</span>
<span id="cb213-79"><a href="#cb213-79" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb213-80"><a href="#cb213-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-81"><a href="#cb213-81" aria-hidden="true" tabindex="-1"></a><span class="co">#clean the titles</span></span>
<span id="cb213-82"><a href="#cb213-82" aria-hidden="true" tabindex="-1"></a>pdfs<span class="ot">&lt;-</span> pdfs <span class="sc">%&gt;%</span> </span>
<span id="cb213-83"><a href="#cb213-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">titles =</span> <span class="fu">str_extract</span>(files, <span class="st">"(?&lt;=-).*(?=</span><span class="sc">\\</span><span class="st">,|-.*-|-</span><span class="sc">\\</span><span class="st">w|</span><span class="sc">\\</span><span class="st">()"</span>),</span>
<span id="cb213-84"><a href="#cb213-84" aria-hidden="true" tabindex="-1"></a>         <span class="at">titles =</span> <span class="fu">str_replace_all</span>(titles, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span> , <span class="st">"_"</span>),</span>
<span id="cb213-85"><a href="#cb213-85" aria-hidden="true" tabindex="-1"></a>         <span class="at">titles =</span> <span class="fu">str_replace_all</span>( titles, <span class="st">"Evidence-Based"</span>, <span class="st">"Evidence_Based"</span>),</span>
<span id="cb213-86"><a href="#cb213-86" aria-hidden="true" tabindex="-1"></a>         <span class="at">titles =</span> <span class="fu">str_replace</span>(titles, <span class="st">"-|,"</span>, <span class="st">" "</span>),</span>
<span id="cb213-87"><a href="#cb213-87" aria-hidden="true" tabindex="-1"></a>         <span class="at">titles =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(titles, <span class="st">" "</span>), </span>
<span id="cb213-88"><a href="#cb213-88" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">str_extract</span>(titles, <span class="st">".*(?= )"</span>), titles),</span>
<span id="cb213-89"><a href="#cb213-89" aria-hidden="true" tabindex="-1"></a>         <span class="at">titles =</span> <span class="fu">str_replace_all</span>(titles, <span class="st">"_+"</span> , <span class="st">" "</span>),</span>
<span id="cb213-90"><a href="#cb213-90" aria-hidden="true" tabindex="-1"></a>         <span class="at">titles =</span> <span class="fu">trimws</span>(titles, <span class="at">which =</span> <span class="st">"both"</span>), </span>
<span id="cb213-91"><a href="#cb213-91" aria-hidden="true" tabindex="-1"></a>         <span class="at">titles =</span> <span class="fu">tolower</span>(titles))</span>
<span id="cb213-92"><a href="#cb213-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-93"><a href="#cb213-93" aria-hidden="true" tabindex="-1"></a>pdfs<span class="ot">&lt;-</span>pdfs <span class="sc">%&gt;%</span> </span>
<span id="cb213-94"><a href="#cb213-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">titles =</span> <span class="fu">case_when</span>(</span>
<span id="cb213-95"><a href="#cb213-95" aria-hidden="true" tabindex="-1"></a>    raw_files <span class="sc">==</span> <span class="st">"3-540-37363-2.pdf"</span> <span class="sc">~</span> <span class="st">"applied physiology in intensive care medicine"</span>,</span>
<span id="cb213-96"><a href="#cb213-96" aria-hidden="true" tabindex="-1"></a>    raw_files <span class="sc">==</span> <span class="st">"978-1-59745-142-0.pdf"</span> <span class="sc">~</span><span class="st">"obstetrics in family medicine"</span>,</span>
<span id="cb213-97"><a href="#cb213-97" aria-hidden="true" tabindex="-1"></a>    raw_files <span class="sc">==</span> <span class="st">"978-1-59745-469-8.pdf"</span> <span class="sc">~</span> <span class="st">"womens health in clinical practice"</span>,</span>
<span id="cb213-98"><a href="#cb213-98" aria-hidden="true" tabindex="-1"></a>    raw_files <span class="sc">==</span> <span class="st">"b138098.pdf"</span> <span class="sc">~</span> <span class="st">"scheins common sense emergency abdominal surgery"</span>,</span>
<span id="cb213-99"><a href="#cb213-99" aria-hidden="true" tabindex="-1"></a>    T <span class="sc">~</span> titles</span>
<span id="cb213-100"><a href="#cb213-100" aria-hidden="true" tabindex="-1"></a>  ), </span>
<span id="cb213-101"><a href="#cb213-101" aria-hidden="true" tabindex="-1"></a>  <span class="at">dates =</span> <span class="fu">case_when</span>(</span>
<span id="cb213-102"><a href="#cb213-102" aria-hidden="true" tabindex="-1"></a>    raw_files <span class="sc">==</span> <span class="st">"b138098.pdf"</span> <span class="sc">~</span> <span class="dv">2005</span>,</span>
<span id="cb213-103"><a href="#cb213-103" aria-hidden="true" tabindex="-1"></a>    raw_files <span class="sc">==</span> <span class="st">"978-1-59745-469-8.pdf"</span> <span class="sc">~</span> <span class="dv">2008</span>,</span>
<span id="cb213-104"><a href="#cb213-104" aria-hidden="true" tabindex="-1"></a>    raw_files <span class="sc">==</span> <span class="st">"978-1-59745-142-0.pdf"</span> <span class="sc">~</span> <span class="dv">2006</span>,</span>
<span id="cb213-105"><a href="#cb213-105" aria-hidden="true" tabindex="-1"></a>    raw_files <span class="sc">==</span> <span class="st">"3-540-37363-2.pdf"</span> <span class="sc">~</span><span class="dv">2006</span>,</span>
<span id="cb213-106"><a href="#cb213-106" aria-hidden="true" tabindex="-1"></a>    T<span class="sc">~</span> dates</span>
<span id="cb213-107"><a href="#cb213-107" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb213-108"><a href="#cb213-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-109"><a href="#cb213-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-112"><a href="#cb213-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-113"><a href="#cb213-113" aria-hidden="true" tabindex="-1"></a>pdfs <span class="sc">%&gt;%</span> head</span>
<span id="cb213-114"><a href="#cb213-114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-115"><a href="#cb213-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-116"><a href="#cb213-116" aria-hidden="true" tabindex="-1"></a>Next, I get the names of the files to read into R from my directories. Because I needed to remove the punctuation of the file names for the OCR (it was throwing some errors), I have to also modify the filenames in R so I can join them.</span>
<span id="cb213-117"><a href="#cb213-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-120"><a href="#cb213-120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-121"><a href="#cb213-121" aria-hidden="true" tabindex="-1"></a>pdfs1<span class="ot">&lt;-</span> pdfs <span class="sc">%&gt;%</span> </span>
<span id="cb213-122"><a href="#cb213-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp =</span> <span class="fu">str_replace_all</span>(raw_files, <span class="fu">c</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span> <span class="ot">=</span> <span class="st">"QQQ"</span>,</span>
<span id="cb213-123"><a href="#cb213-123" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"[[:punct:]]|</span><span class="sc">\\</span><span class="st">s+"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb213-124"><a href="#cb213-124" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"QQQ"</span> <span class="ot">=</span> <span class="st">"."</span>,</span>
<span id="cb213-125"><a href="#cb213-125" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"</span><span class="sc">\\</span><span class="st">.pdf"</span> <span class="ot">=</span> <span class="st">""</span>)),</span>
<span id="cb213-126"><a href="#cb213-126" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp2 =</span> <span class="fu">str_replace_all</span>(raw_files, <span class="fu">c</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.pdf$"</span> <span class="ot">=</span> <span class="st">""</span>)),</span>
<span id="cb213-127"><a href="#cb213-127" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp2 =</span><span class="fu">ifelse</span>(<span class="fu">str_detect</span>(titles, <span class="st">"clinical anatomy a revision"</span>),</span>
<span id="cb213-128"><a href="#cb213-128" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"HaroldEllisClinicalAnatomyARevisionandAppliedAnatomyforClinicalStudents"</span>, temp2)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-129"><a href="#cb213-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">matches</span>(<span class="st">"temp"</span>), <span class="at">values_to =</span> <span class="st">"files1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-130"><a href="#cb213-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(titles, dates, <span class="at">files =</span>files1) <span class="sc">%&gt;%</span> </span>
<span id="cb213-131"><a href="#cb213-131" aria-hidden="true" tabindex="-1"></a>  unique</span>
<span id="cb213-132"><a href="#cb213-132" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb213-133"><a href="#cb213-133" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">raw_files =</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"/Users/emmanuelmiller/Desktop/thetext"</span>,</span>
<span id="cb213-134"><a href="#cb213-134" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">full.names =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-135"><a href="#cb213-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">files =</span> <span class="fu">str_extract</span>(raw_files, <span class="st">"(?&lt;=thetext.).+(?=_Page)"</span>),</span>
<span id="cb213-136"><a href="#cb213-136" aria-hidden="true" tabindex="-1"></a>         <span class="at">files =</span> <span class="fu">str_remove</span>(files, <span class="st">"edite*d*_*"</span>))</span>
<span id="cb213-137"><a href="#cb213-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-138"><a href="#cb213-138" aria-hidden="true" tabindex="-1"></a>pdfs1<span class="ot">&lt;-</span> pdfs1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-139"><a href="#cb213-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(., temp)</span>
<span id="cb213-140"><a href="#cb213-140" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-141"><a href="#cb213-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-144"><a href="#cb213-144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-145"><a href="#cb213-145" aria-hidden="true" tabindex="-1"></a>pdfs1 <span class="sc">%&gt;%</span> head</span>
<span id="cb213-146"><a href="#cb213-146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-147"><a href="#cb213-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-148"><a href="#cb213-148" aria-hidden="true" tabindex="-1"></a>I made an excel sheet and documented the volume and edition numbers of the books I use. I could extract the metadata using code for this part of the dataset, but for the sake of consistency with the IA dataset, and ensuring correct metadata, I decided to do this portion by hand.</span>
<span id="cb213-149"><a href="#cb213-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-152"><a href="#cb213-152" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-153"><a href="#cb213-153" aria-hidden="true" tabindex="-1"></a>book_metadata <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/book_metadata.xlsx"</span>) </span>
<span id="cb213-154"><a href="#cb213-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-155"><a href="#cb213-155" aria-hidden="true" tabindex="-1"></a>pdfs2<span class="ot">&lt;-</span>pdfs1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-156"><a href="#cb213-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., book_metadata <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>titles, <span class="sc">-</span>dates, <span class="sc">-</span>type), </span>
<span id="cb213-157"><a href="#cb213-157" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"files"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-158"><a href="#cb213-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(titles, dates) <span class="sc">%&gt;%</span> </span>
<span id="cb213-159"><a href="#cb213-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(<span class="fu">matches</span>(<span class="st">"edition|volume|part"</span>), <span class="at">.direction =</span> <span class="fu">c</span>(<span class="st">"updown"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-160"><a href="#cb213-160" aria-hidden="true" tabindex="-1"></a>  ungroup</span>
<span id="cb213-161"><a href="#cb213-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-162"><a href="#cb213-162" aria-hidden="true" tabindex="-1"></a>pdfs2 <span class="sc">%&gt;%</span> head <span class="sc">%&gt;%</span> kable</span>
<span id="cb213-163"><a href="#cb213-163" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-164"><a href="#cb213-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-165"><a href="#cb213-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-166"><a href="#cb213-166" aria-hidden="true" tabindex="-1"></a><span class="fu">### Internet Archive Data</span></span>
<span id="cb213-167"><a href="#cb213-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-168"><a href="#cb213-168" aria-hidden="true" tabindex="-1"></a>Like the inter-library loan dataset, I also needed to extract metadata for the files I downloaded. I decided to do this manually because I had not yet finished cleaning the OCR and I wanted to ensure that I didn't have duplicate books. I found that 4 of the books had incorrect dates and 2 of the books were from before 1875. The only reason why I found metadata for these books was from a note from the library in the back of the book. I decided to carry out metadata-searching manually.</span>
<span id="cb213-169"><a href="#cb213-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-172"><a href="#cb213-172" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-173"><a href="#cb213-173" aria-hidden="true" tabindex="-1"></a>texts<span class="ot">&lt;-</span> book_metadata <span class="sc">%&gt;%</span> </span>
<span id="cb213-174"><a href="#cb213-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"ia"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-175"><a href="#cb213-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>type)</span>
<span id="cb213-176"><a href="#cb213-176" aria-hidden="true" tabindex="-1"></a><span class="do">###make sure titles match</span></span>
<span id="cb213-177"><a href="#cb213-177" aria-hidden="true" tabindex="-1"></a><span class="co"># texts&lt;- dat8 %&gt;% </span></span>
<span id="cb213-178"><a href="#cb213-178" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(titles, dates, files=hrefs) %&gt;% </span></span>
<span id="cb213-179"><a href="#cb213-179" aria-hidden="true" tabindex="-1"></a><span class="co">#   right</span></span>
<span id="cb213-180"><a href="#cb213-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-181"><a href="#cb213-181" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">raw_files =</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"/Users/emmanuelmiller/Desktop/text_ia"</span>,</span>
<span id="cb213-182"><a href="#cb213-182" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">full.names =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-183"><a href="#cb213-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">files =</span> <span class="fu">str_extract</span>(raw_files, <span class="st">"(?&lt;=text_ia.).+(?=_Page)"</span>),</span>
<span id="cb213-184"><a href="#cb213-184" aria-hidden="true" tabindex="-1"></a>         <span class="at">files =</span> <span class="fu">str_remove</span>(files, <span class="st">"edits_|edite*d*_*"</span>))</span>
<span id="cb213-185"><a href="#cb213-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-186"><a href="#cb213-186" aria-hidden="true" tabindex="-1"></a>texts<span class="ot">&lt;-</span> texts <span class="sc">%&gt;%</span> </span>
<span id="cb213-187"><a href="#cb213-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(., temp)</span>
<span id="cb213-188"><a href="#cb213-188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-189"><a href="#cb213-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-190"><a href="#cb213-190" aria-hidden="true" tabindex="-1"></a>I combine both the inter-library loan and the internet archive datasets. This will help me </span>
<span id="cb213-191"><a href="#cb213-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-194"><a href="#cb213-194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-195"><a href="#cb213-195" aria-hidden="true" tabindex="-1"></a><span class="co"># texts %&gt;% names</span></span>
<span id="cb213-196"><a href="#cb213-196" aria-hidden="true" tabindex="-1"></a><span class="co"># pdfs2 %&gt;% names</span></span>
<span id="cb213-197"><a href="#cb213-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-198"><a href="#cb213-198" aria-hidden="true" tabindex="-1"></a>texts<span class="ot">&lt;-</span> texts <span class="sc">%&gt;%</span> </span>
<span id="cb213-199"><a href="#cb213-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"ia"</span>)</span>
<span id="cb213-200"><a href="#cb213-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-201"><a href="#cb213-201" aria-hidden="true" tabindex="-1"></a>pdfs2<span class="ot">&lt;-</span> pdfs2 <span class="sc">%&gt;%</span> </span>
<span id="cb213-202"><a href="#cb213-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(raw_files, <span class="at">.after=</span> <span class="st">"part"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-203"><a href="#cb213-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"ill"</span>)</span>
<span id="cb213-204"><a href="#cb213-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-205"><a href="#cb213-205" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(texts, pdfs2) </span>
<span id="cb213-206"><a href="#cb213-206" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb213-207"><a href="#cb213-207" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span>dat <span class="sc">%&gt;%</span> </span>
<span id="cb213-208"><a href="#cb213-208" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>files) <span class="sc">%&gt;%</span> </span>
<span id="cb213-209"><a href="#cb213-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(raw_files))</span>
<span id="cb213-210"><a href="#cb213-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-211"><a href="#cb213-211" aria-hidden="true" tabindex="-1"></a><span class="co"># bind_rows(texts, pdfs1) %&gt;% </span></span>
<span id="cb213-212"><a href="#cb213-212" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(type, files) %&gt;% </span></span>
<span id="cb213-213"><a href="#cb213-213" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(type, titles, dates, files) %&gt;%unique %&gt;% </span></span>
<span id="cb213-214"><a href="#cb213-214" aria-hidden="true" tabindex="-1"></a><span class="co">#   openxlsx::write.xlsx(., file = "temp.xlsx")</span></span>
<span id="cb213-215"><a href="#cb213-215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-216"><a href="#cb213-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-217"><a href="#cb213-217" aria-hidden="true" tabindex="-1"></a>Finally, I added page numbers and read in the files. I saved this because it takes a long time to load in.</span>
<span id="cb213-218"><a href="#cb213-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-219"><a href="#cb213-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = F}</span></span>
<span id="cb213-220"><a href="#cb213-220" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb213-221"><a href="#cb213-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">page =</span> <span class="fu">str_extract</span>(raw_files, <span class="st">"(?&lt;=Page_)</span><span class="sc">\\</span><span class="st">d+"</span>),</span>
<span id="cb213-222"><a href="#cb213-222" aria-hidden="true" tabindex="-1"></a>         <span class="at">page =</span> <span class="fu">as.numeric</span>(page)) </span>
<span id="cb213-223"><a href="#cb213-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-224"><a href="#cb213-224" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span>dat <span class="sc">%&gt;%</span> </span>
<span id="cb213-225"><a href="#cb213-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span><span class="fu">map</span>(raw_files, <span class="sc">~</span><span class="fu">read_lines</span>(.)))</span>
<span id="cb213-226"><a href="#cb213-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-227"><a href="#cb213-227" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(dat, <span class="at">file =</span> <span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/dat.RData"</span>)</span>
<span id="cb213-228"><a href="#cb213-228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-229"><a href="#cb213-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-232"><a href="#cb213-232" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-233"><a href="#cb213-233" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/dat.RData"</span>)</span>
<span id="cb213-234"><a href="#cb213-234" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> head </span>
<span id="cb213-235"><a href="#cb213-235" aria-hidden="true" tabindex="-1"></a><span class="co"># save(dat, file = "dat.RData")</span></span>
<span id="cb213-236"><a href="#cb213-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-237"><a href="#cb213-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-238"><a href="#cb213-238" aria-hidden="true" tabindex="-1"></a>Because the separator was a new line, there are multiple rows for 1 page. I combine them into 1 page here.</span>
<span id="cb213-239"><a href="#cb213-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-242"><a href="#cb213-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-243"><a href="#cb213-243" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb213-244"><a href="#cb213-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>raw_files) <span class="sc">%&gt;%</span> </span>
<span id="cb213-245"><a href="#cb213-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">map</span>(dat,<span class="sc">~</span><span class="fu">str_c</span>(., <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb213-246"><a href="#cb213-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(dat)</span>
<span id="cb213-247"><a href="#cb213-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-248"><a href="#cb213-248" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> tail <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">str_sub</span>(dat, <span class="dv">1</span>, <span class="dv">100</span>))</span>
<span id="cb213-249"><a href="#cb213-249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-250"><a href="#cb213-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-251"><a href="#cb213-251" aria-hidden="true" tabindex="-1"></a><span class="fu"># Cleaning</span></span>
<span id="cb213-252"><a href="#cb213-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-253"><a href="#cb213-253" aria-hidden="true" tabindex="-1"></a>Some of the files in the Internet Archive dataset have a notice from google saying that their copyrights have expired. Because these aren't part of the actual dataset, I remove them. I also remove empty pages, which I assume were because of some images being printed on one side. It may also be possible that these were censored, but it is unclear. If this were the case, it may affect the accuracy of the conclusions I draw in this pilot study. In a larger work, I would recommend obtaining all books from interlibrary loan as PDFs.</span>
<span id="cb213-254"><a href="#cb213-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-257"><a href="#cb213-257" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-258"><a href="#cb213-258" aria-hidden="true" tabindex="-1"></a>dat1<span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb213-259"><a href="#cb213-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(dat, <span class="st">"(?i)google"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-260"><a href="#cb213-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">str_remove</span>(dat, <span class="st">"^</span><span class="sc">\\</span><span class="st">s+$"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-261"><a href="#cb213-261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb213-262"><a href="#cb213-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(dat))</span>
<span id="cb213-263"><a href="#cb213-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-264"><a href="#cb213-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-265"><a href="#cb213-265" aria-hidden="true" tabindex="-1"></a>I noticed that there were many whitespaces on each page. I decided to remove whitespaces since I would like to do sentence-level analyses. I also removed extraneous punctuation. Because I plan to tokenize using the Quanteda package, I will keep some essential punctuation.</span>
<span id="cb213-266"><a href="#cb213-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-269"><a href="#cb213-269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-270"><a href="#cb213-270" aria-hidden="true" tabindex="-1"></a>dat1<span class="ot">&lt;-</span> dat1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-271"><a href="#cb213-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">str_replace_all</span>(dat, <span class="fu">c</span>(</span>
<span id="cb213-272"><a href="#cb213-272" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\\</span><span class="st">t"</span> <span class="ot">=</span> <span class="st">" "</span>,</span>
<span id="cb213-273"><a href="#cb213-273" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\\</span><span class="st">n"</span> <span class="ot">=</span> <span class="st">" "</span>,</span>
<span id="cb213-274"><a href="#cb213-274" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\\</span><span class="st">r"</span> <span class="ot">=</span> <span class="st">" "</span>,</span>
<span id="cb213-275"><a href="#cb213-275" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\\</span><span class="st">|"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb213-276"><a href="#cb213-276" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span> <span class="ot">=</span> <span class="st">" "</span>,</span>
<span id="cb213-277"><a href="#cb213-277" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">w)</span><span class="sc">\\</span><span class="st">s*-</span><span class="sc">\\</span><span class="st">s*(?=</span><span class="sc">\\</span><span class="st">w)"</span> <span class="ot">=</span> <span class="st">"IWASAHYPHEN"</span>,</span>
<span id="cb213-278"><a href="#cb213-278" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"'"</span> <span class="ot">=</span> <span class="st">"IWASASINGLEQUOTE"</span>,</span>
<span id="cb213-279"><a href="#cb213-279" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\\</span><span class="st">."</span> <span class="ot">=</span> <span class="st">"IWASAPERIOD"</span>,</span>
<span id="cb213-280"><a href="#cb213-280" aria-hidden="true" tabindex="-1"></a>                       <span class="st">","</span> <span class="ot">=</span> <span class="st">"IWASACOMMA"</span>,</span>
<span id="cb213-281"><a href="#cb213-281" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"[[:punct:]]+"</span> <span class="ot">=</span> <span class="st">" "</span>,</span>
<span id="cb213-282"><a href="#cb213-282" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span> <span class="ot">=</span> <span class="st">" "</span></span>
<span id="cb213-283"><a href="#cb213-283" aria-hidden="true" tabindex="-1"></a>                       )),</span>
<span id="cb213-284"><a href="#cb213-284" aria-hidden="true" tabindex="-1"></a>         <span class="at">dat =</span> <span class="fu">str_remove_all</span>(dat, <span class="st">"[^[:alnum:]</span><span class="sc">\\</span><span class="st">s]"</span>),</span>
<span id="cb213-285"><a href="#cb213-285" aria-hidden="true" tabindex="-1"></a>         <span class="at">dat =</span> <span class="fu">str_replace_all</span>(dat, <span class="fu">c</span>(</span>
<span id="cb213-286"><a href="#cb213-286" aria-hidden="true" tabindex="-1"></a>           <span class="st">"IWASAHYPHEN"</span> <span class="ot">=</span> <span class="st">"-"</span>,</span>
<span id="cb213-287"><a href="#cb213-287" aria-hidden="true" tabindex="-1"></a>           <span class="st">"IWASAPERIOD"</span> <span class="ot">=</span> <span class="st">"."</span>,</span>
<span id="cb213-288"><a href="#cb213-288" aria-hidden="true" tabindex="-1"></a>           <span class="st">"IWASACOMMA"</span> <span class="ot">=</span> <span class="st">","</span>,</span>
<span id="cb213-289"><a href="#cb213-289" aria-hidden="true" tabindex="-1"></a>           <span class="st">"IWASASINGLEQUOTE"</span> <span class="ot">=</span> <span class="st">"'"</span></span>
<span id="cb213-290"><a href="#cb213-290" aria-hidden="true" tabindex="-1"></a>         ))</span>
<span id="cb213-291"><a href="#cb213-291" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb213-292"><a href="#cb213-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-293"><a href="#cb213-293" aria-hidden="true" tabindex="-1"></a>dat1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-294"><a href="#cb213-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">str_sub</span>(dat, <span class="dv">1</span>, <span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-295"><a href="#cb213-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(titles, dates) <span class="sc">%&gt;%</span> </span>
<span id="cb213-296"><a href="#cb213-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-297"><a href="#cb213-297" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb213-298"><a href="#cb213-298" aria-hidden="true" tabindex="-1"></a>  kable</span>
<span id="cb213-299"><a href="#cb213-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-300"><a href="#cb213-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-301"><a href="#cb213-301" aria-hidden="true" tabindex="-1"></a>I noticed that there are many single characters that are a result of either noise being transcribed or because of images that were transcribed. I remove these single characters and duplicate periods.</span>
<span id="cb213-302"><a href="#cb213-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-305"><a href="#cb213-305" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-306"><a href="#cb213-306" aria-hidden="true" tabindex="-1"></a>dat1<span class="ot">&lt;-</span> dat1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-307"><a href="#cb213-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">stri_replace_all_regex</span>(dat, <span class="fu">paste0</span>(<span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">.|</span><span class="sc">\\</span><span class="st">s)"</span>, </span>
<span id="cb213-308"><a href="#cb213-308" aria-hidden="true" tabindex="-1"></a>                                                  letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">26</span>],</span>
<span id="cb213-309"><a href="#cb213-309" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"(?=</span><span class="sc">\\</span><span class="st">.|</span><span class="sc">\\</span><span class="st">s)"</span>), <span class="fu">rep</span>(<span class="st">""</span>, <span class="dv">26</span>),</span>
<span id="cb213-310"><a href="#cb213-310" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">vectorize_all =</span> F),</span>
<span id="cb213-311"><a href="#cb213-311" aria-hidden="true" tabindex="-1"></a>         <span class="at">dat =</span> <span class="fu">stri_replace_all_regex</span>(dat, <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">b"</span>, </span>
<span id="cb213-312"><a href="#cb213-312" aria-hidden="true" tabindex="-1"></a>                                                  letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">26</span>], </span>
<span id="cb213-313"><a href="#cb213-313" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"</span><span class="sc">\\</span><span class="st">b"</span>), <span class="fu">rep</span>(<span class="st">""</span>, <span class="dv">26</span>),</span>
<span id="cb213-314"><a href="#cb213-314" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">vectorize_all =</span> F)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-315"><a href="#cb213-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">stri_replace_all_regex</span>(dat, <span class="fu">paste0</span>(<span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">.|</span><span class="sc">\\</span><span class="st">s)"</span>, </span>
<span id="cb213-316"><a href="#cb213-316" aria-hidden="true" tabindex="-1"></a>                                            LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">26</span>],</span>
<span id="cb213-317"><a href="#cb213-317" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"(?=</span><span class="sc">\\</span><span class="st">.|</span><span class="sc">\\</span><span class="st">s)"</span>), <span class="fu">rep</span>(<span class="st">""</span>, <span class="dv">26</span>),</span>
<span id="cb213-318"><a href="#cb213-318" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">vectorize_all =</span> F), </span>
<span id="cb213-319"><a href="#cb213-319" aria-hidden="true" tabindex="-1"></a>         <span class="at">dat =</span> <span class="fu">stri_replace_all_regex</span>(dat, <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">b"</span>, </span>
<span id="cb213-320"><a href="#cb213-320" aria-hidden="true" tabindex="-1"></a>                                            LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">26</span>],</span>
<span id="cb213-321"><a href="#cb213-321" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"</span><span class="sc">\\</span><span class="st">b"</span>), <span class="fu">rep</span>(<span class="st">""</span>, <span class="dv">26</span>), </span>
<span id="cb213-322"><a href="#cb213-322" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">vectorize_all =</span> F)) </span>
<span id="cb213-323"><a href="#cb213-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-324"><a href="#cb213-324" aria-hidden="true" tabindex="-1"></a>dat1<span class="ot">&lt;-</span>dat1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-325"><a href="#cb213-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">str_replace_all</span>(dat, <span class="fu">c</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span> <span class="ot">=</span> <span class="st">" "</span>,</span>
<span id="cb213-326"><a href="#cb213-326" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"</span><span class="sc">\\</span><span class="st">.+"</span> <span class="ot">=</span> <span class="st">"."</span>,</span>
<span id="cb213-327"><a href="#cb213-327" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"(</span><span class="sc">\\</span><span class="st">s?</span><span class="sc">\\</span><span class="st">.)+"</span> <span class="ot">=</span> <span class="st">"."</span>,</span>
<span id="cb213-328"><a href="#cb213-328" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"^</span><span class="sc">\\</span><span class="st">s+$"</span> <span class="ot">=</span> <span class="st">""</span></span>
<span id="cb213-329"><a href="#cb213-329" aria-hidden="true" tabindex="-1"></a>                                          )</span>
<span id="cb213-330"><a href="#cb213-330" aria-hidden="true" tabindex="-1"></a>                                 )) <span class="sc">%&gt;%</span> </span>
<span id="cb213-331"><a href="#cb213-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-332"><a href="#cb213-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(dat))</span>
<span id="cb213-333"><a href="#cb213-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-334"><a href="#cb213-334" aria-hidden="true" tabindex="-1"></a>dat1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-335"><a href="#cb213-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">str_sub</span>(dat, <span class="dv">1</span>, <span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-336"><a href="#cb213-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(titles, dates) <span class="sc">%&gt;%</span> </span>
<span id="cb213-337"><a href="#cb213-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-338"><a href="#cb213-338" aria-hidden="true" tabindex="-1"></a>  ungroup<span class="sc">%&gt;%</span> </span>
<span id="cb213-339"><a href="#cb213-339" aria-hidden="true" tabindex="-1"></a>  kable</span>
<span id="cb213-340"><a href="#cb213-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-341"><a href="#cb213-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-342"><a href="#cb213-342" aria-hidden="true" tabindex="-1"></a><span class="fu"># Cleaning Using Dictionaries</span></span>
<span id="cb213-343"><a href="#cb213-343" aria-hidden="true" tabindex="-1"></a><span class="fu">### Overview</span></span>
<span id="cb213-344"><a href="#cb213-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-345"><a href="#cb213-345" aria-hidden="true" tabindex="-1"></a>Many pages contain letters that aren't reflective of the text. This is partly a result of attempting to read diagrams with words or places where there was lots of background noise that couldn't be removed. Some of the older texts have words that were misspelled. In order to further remove some of these strings of characters, I will use the Hunspell package to check whether a word is misspelled, and if it is, I remove it from the corpus. I will go into this further in the next section and that I will need to take this into consideration if using certain analytical methods such as machine learning. One issue I noticed with this approach is that some words that are in the medical lexicon are marked as misspelled. In order to counter this, I incorporate words from medical books to help with this process.</span>
<span id="cb213-346"><a href="#cb213-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-347"><a href="#cb213-347" aria-hidden="true" tabindex="-1"></a>I used selection criteria as follows. I decided to choose books that have been OCR'd by a human and therefore are more certainly reflective the original text, or if they already came in a text format like epub. For the quantity of books that I use I had to consider the availability of this high-quality OCR data as well as my research question. I am looking at 2 different time periods, pre-1970s and post-1970s, and my corpus is rather small with roughly 30 books per time period. Unfortunately, there are not many well-OCR'd older medical texts widely available on the internet. After speaking with Dr. Song, I decided that I would use 2 books to build this medical dictionary (so 1 book per time period). </span>
<span id="cb213-348"><a href="#cb213-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-349"><a href="#cb213-349" aria-hidden="true" tabindex="-1"></a>I also considered 2 different approaches for getting just medical vocabulary. I first considered tokenizing the whole book, removing stopwords, and using the whole thing as a medical dictionary. I found that using this approach, in combination with fuzzy-matching (which I do later), allowed shorter ~3 letter words which were wrongly transcribed to be marked as "good". I then considered using only the index of the book. This automatically selects keywords that are reviewed in the text and are primarily related to anatomy or pathology. I decided on the latter approach as it was more stringent and allowed fewer false-positives.</span>
<span id="cb213-350"><a href="#cb213-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-351"><a href="#cb213-351" aria-hidden="true" tabindex="-1"></a>I review the cleaning and application of this method inn 3 sections.</span>
<span id="cb213-352"><a href="#cb213-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-353"><a href="#cb213-353" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pre-1970's Text Acquisition and Cleaning</span></span>
<span id="cb213-354"><a href="#cb213-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-355"><a href="#cb213-355" aria-hidden="true" tabindex="-1"></a>For the pre-1970s text, I reviewed project Gutenberg because their books have been transcribed by a submitter. I searched "anatomy" and "gynecology". I considered books only relating to humans and targeted towards the medical profession. I chose "Structure and Functions of The Body" by Annette Fiske, published in 1911. This is one of the few that reviewed vaginal anatomy. Typographical changes were made by the transcriber, which adds a layer of review to this transcriptions.</span>
<span id="cb213-356"><a href="#cb213-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-357"><a href="#cb213-357" aria-hidden="true" tabindex="-1"></a>I decided to webscrape the text file from the Project Gutenberg website as this was less trouble than fighting with the gutenbergr R package or Firefox on downloading the text version.</span>
<span id="cb213-358"><a href="#cb213-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-361"><a href="#cb213-361" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-362"><a href="#cb213-362" aria-hidden="true" tabindex="-1"></a><span class="co">#make dictionary -- gutenberg</span></span>
<span id="cb213-363"><a href="#cb213-363" aria-hidden="true" tabindex="-1"></a>polite<span class="sc">::</span><span class="fu">bow</span>(<span class="st">"https://gutenberg.org/files/64754/64754-0.txt"</span>)</span>
<span id="cb213-364"><a href="#cb213-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-365"><a href="#cb213-365" aria-hidden="true" tabindex="-1"></a>guten<span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">read_html</span>(<span class="st">"https://gutenberg.org/files/64754/64754-0.txt"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-366"><a href="#cb213-366" aria-hidden="true" tabindex="-1"></a>  rvest<span class="sc">::</span><span class="fu">html_nodes</span>(.,<span class="at">xpath=</span><span class="st">"/html/body/*"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-367"><a href="#cb213-367" aria-hidden="true" tabindex="-1"></a>  rvest<span class="sc">::</span><span class="fu">html_text</span>()</span>
<span id="cb213-368"><a href="#cb213-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-369"><a href="#cb213-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-370"><a href="#cb213-370" aria-hidden="true" tabindex="-1"></a>Next I select only the index portion of the text and remove extraneous punctuation and words (like "et seq" which is a way to reference page numbers). I also made duplicate words which had both "'s" and without.</span>
<span id="cb213-371"><a href="#cb213-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-374"><a href="#cb213-374" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-375"><a href="#cb213-375" aria-hidden="true" tabindex="-1"></a>guten1<span class="ot">&lt;-</span><span class="fu">tibble</span>(<span class="at">book =</span> guten) <span class="sc">%&gt;%</span> </span>
<span id="cb213-376"><a href="#cb213-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">str_extract</span>(book, <span class="st">"(?&lt;=INDEX</span><span class="sc">\\</span><span class="st">.)[</span><span class="sc">\\</span><span class="st">s</span><span class="sc">\\</span><span class="st">S]*(?=SAUNDERS. BOOKS FOR NURSES)"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-377"><a href="#cb213-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>book)</span>
<span id="cb213-378"><a href="#cb213-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-379"><a href="#cb213-379" aria-hidden="true" tabindex="-1"></a>guten2<span class="ot">&lt;-</span> guten1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-380"><a href="#cb213-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">str_replace_all</span>(index, <span class="fu">c</span>(<span class="st">".et seq..|.et seq."</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb213-381"><a href="#cb213-381" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb213-382"><a href="#cb213-382" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">","</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb213-383"><a href="#cb213-383" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"æ"</span> <span class="ot">=</span> <span class="st">"ae"</span></span>
<span id="cb213-384"><a href="#cb213-384" aria-hidden="true" tabindex="-1"></a>                                          ))) <span class="sc">%&gt;%</span> </span>
<span id="cb213-385"><a href="#cb213-385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">other0 =</span> <span class="fu">str_extract</span>(index, <span class="st">"</span><span class="sc">\\</span><span class="st">w+(?='s)"</span>),</span>
<span id="cb213-386"><a href="#cb213-386" aria-hidden="true" tabindex="-1"></a>         <span class="at">other =</span> <span class="fu">str_remove_all</span>(index, <span class="st">"-"</span>),</span>
<span id="cb213-387"><a href="#cb213-387" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">str_replace_all</span>(., <span class="fu">c</span>(<span class="st">"[:punct:]+"</span><span class="ot">=</span> <span class="st">""</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb213-388"><a href="#cb213-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">values_to =</span> <span class="st">"index"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-389"><a href="#cb213-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb213-390"><a href="#cb213-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-391"><a href="#cb213-391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(index)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-392"><a href="#cb213-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(index, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">n"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-393"><a href="#cb213-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">trimws</span>(index, <span class="at">which =</span> <span class="st">"both"</span>),</span>
<span id="cb213-394"><a href="#cb213-394" aria-hidden="true" tabindex="-1"></a>         <span class="at">nchar =</span> <span class="fu">nchar</span>(index))</span>
<span id="cb213-395"><a href="#cb213-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-396"><a href="#cb213-396" aria-hidden="true" tabindex="-1"></a>guten2 <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb213-397"><a href="#cb213-397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-398"><a href="#cb213-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-399"><a href="#cb213-399" aria-hidden="true" tabindex="-1"></a>After, I tokenize each word in the index and remove stopwords (such as "of") from the corpus. I then reviewed words that were 3-4 characters to confirm that they were medically related. </span>
<span id="cb213-400"><a href="#cb213-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-403"><a href="#cb213-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-404"><a href="#cb213-404" aria-hidden="true" tabindex="-1"></a>guten3<span class="ot">&lt;-</span>guten2 <span class="sc">%&gt;%</span> </span>
<span id="cb213-405"><a href="#cb213-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">tolower</span>(index),</span>
<span id="cb213-406"><a href="#cb213-406" aria-hidden="true" tabindex="-1"></a>         <span class="at">index =</span> <span class="fu">str_replace_all</span>(index, <span class="fu">c</span>(<span class="st">"'s"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb213-407"><a href="#cb213-407" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"'"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb213-408"><a href="#cb213-408" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">'</span><span class="sc">\\</span><span class="st">"'</span> <span class="ot">=</span> <span class="st">''</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb213-409"><a href="#cb213-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(index, <span class="at">sep =</span> <span class="st">" "</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-410"><a href="#cb213-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">trimws</span>(index, <span class="at">which =</span> <span class="st">"both"</span>),</span>
<span id="cb213-411"><a href="#cb213-411" aria-hidden="true" tabindex="-1"></a>         <span class="at">nchar =</span> <span class="fu">nchar</span>(index)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-412"><a href="#cb213-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-413"><a href="#cb213-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(index) <span class="sc">&amp;</span> <span class="sc">!</span>(index <span class="sc">%in%</span> tm<span class="sc">::</span><span class="fu">stopwords</span>()) ) <span class="sc">%&gt;%</span> </span>
<span id="cb213-414"><a href="#cb213-414" aria-hidden="true" tabindex="-1"></a>  unique</span>
<span id="cb213-415"><a href="#cb213-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-416"><a href="#cb213-416" aria-hidden="true" tabindex="-1"></a>guten3 <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(nchar) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb213-417"><a href="#cb213-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-418"><a href="#cb213-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-419"><a href="#cb213-419" aria-hidden="true" tabindex="-1"></a><span class="fu">### Post 1970's Text Acquisition and Cleaning</span></span>
<span id="cb213-420"><a href="#cb213-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-421"><a href="#cb213-421" aria-hidden="true" tabindex="-1"></a>To acquire a post-1970's text, I searched "gynecology" and "anatomy" with tags "medical" in the UMass Amherst library catalog. I then searched for "epub" as the format. I chose "Clinically Oriented Anatomy 7th edition" by Keith Moore et al., published in 2014. I converted the epub to a text document using convertio.co (which is a website that I found by googling "epub to txt convert"). I downloaded the converted book and selected only the index.</span>
<span id="cb213-422"><a href="#cb213-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-425"><a href="#cb213-425" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-426"><a href="#cb213-426" aria-hidden="true" tabindex="-1"></a>moore<span class="ot">&lt;-</span> <span class="fu">read_file</span>(<span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/Keith-L.-Moore-PhD-FIAC-FRSM-FAAA_-Anne-M.-R.-Agur-BSc-_OT_-MSc-PhD_-Arthur-F.txt"</span>)</span>
<span id="cb213-427"><a href="#cb213-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-428"><a href="#cb213-428" aria-hidden="true" tabindex="-1"></a>moore1<span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">book =</span> moore) <span class="sc">%&gt;%</span> </span>
<span id="cb213-429"><a href="#cb213-429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">str_extract</span>(book, <span class="st">"(?&lt;=Index)</span><span class="sc">\\</span><span class="st">s+A</span><span class="sc">\\</span><span class="st">s+[</span><span class="sc">\\</span><span class="st">s</span><span class="sc">\\</span><span class="st">S]*$"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-430"><a href="#cb213-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>book) <span class="sc">%&gt;%</span> </span>
<span id="cb213-431"><a href="#cb213-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(index, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">n</span><span class="sc">\\</span><span class="st">n"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-432"><a href="#cb213-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-433"><a href="#cb213-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(index))</span>
<span id="cb213-434"><a href="#cb213-434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-435"><a href="#cb213-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-436"><a href="#cb213-436" aria-hidden="true" tabindex="-1"></a>Like the pre-1970's dictionary, I remove punctuation and make both forms of words with "'s" and without.</span>
<span id="cb213-437"><a href="#cb213-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-440"><a href="#cb213-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-441"><a href="#cb213-441" aria-hidden="true" tabindex="-1"></a>moore2<span class="ot">&lt;-</span> moore1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-442"><a href="#cb213-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">other0 =</span> <span class="fu">str_extract</span>(index, <span class="st">"</span><span class="sc">\\</span><span class="st">w+(?='s)"</span>),</span>
<span id="cb213-443"><a href="#cb213-443" aria-hidden="true" tabindex="-1"></a>         <span class="at">other =</span> <span class="fu">str_remove_all</span>(index, <span class="st">"-"</span>),</span>
<span id="cb213-444"><a href="#cb213-444" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">str_replace_all</span>(., <span class="fu">c</span>(<span class="st">"[:punct:]+"</span><span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb213-445"><a href="#cb213-445" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span><span class="ot">=</span> <span class="st">""</span>))),</span>
<span id="cb213-446"><a href="#cb213-446" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">tolower</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb213-447"><a href="#cb213-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">values_to =</span> <span class="st">"index"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-448"><a href="#cb213-448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb213-449"><a href="#cb213-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-450"><a href="#cb213-450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(index))</span>
<span id="cb213-451"><a href="#cb213-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-452"><a href="#cb213-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-453"><a href="#cb213-453" aria-hidden="true" tabindex="-1"></a>Finally, I tokenize the index and remove stopwords. I reviewed words that were 2-3 characters long to confirm they were medically related. I found that there are times when French (such as "Le" for "Le Fort fracture") or acronyms are used (such as "ap" for anteposterior or "pa" posteroanterior). Some were remains of numbering (such as "1st" being "st"). Others were single letters because of being contractions with numbers ("c1", which is the first cervical vertebra, was converted to "c") or because single letters were written at the top of each page. I also noticed roman numerals were included because of the numbering of the cranial nerves.</span>
<span id="cb213-454"><a href="#cb213-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-457"><a href="#cb213-457" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-458"><a href="#cb213-458" aria-hidden="true" tabindex="-1"></a>moore3<span class="ot">&lt;-</span> moore2 <span class="sc">%&gt;%</span> </span>
<span id="cb213-459"><a href="#cb213-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(index, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-460"><a href="#cb213-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-461"><a href="#cb213-461" aria-hidden="true" tabindex="-1"></a>  unique <span class="sc">%&gt;%</span> </span>
<span id="cb213-462"><a href="#cb213-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nchar =</span> <span class="fu">nchar</span>(index))</span>
<span id="cb213-463"><a href="#cb213-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-464"><a href="#cb213-464" aria-hidden="true" tabindex="-1"></a>moore3 <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(nchar) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">40</span>)</span>
<span id="cb213-465"><a href="#cb213-465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-466"><a href="#cb213-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-467"><a href="#cb213-467" aria-hidden="true" tabindex="-1"></a>I ended up removing words which had fewer than 3 characters because these short words would already be removed with earlier cleaning of the corpus, and because they usually co-occur with more substantive nouns within the index (ex. the whole string containing "c1" was "c1 spine" or "l2 vertebra" meaning the second lumbar vertebra). I also found that short strings in a dictionary tended to lead to false-positive words (that were made by Tesseract misreading grainy pictures).</span>
<span id="cb213-468"><a href="#cb213-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-471"><a href="#cb213-471" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-472"><a href="#cb213-472" aria-hidden="true" tabindex="-1"></a>moore3<span class="ot">&lt;-</span>moore3 <span class="sc">%&gt;%</span> </span>
<span id="cb213-473"><a href="#cb213-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nchar <span class="sc">&gt;</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-474"><a href="#cb213-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(index <span class="sc">%in%</span> letters) <span class="sc">&amp;</span> </span>
<span id="cb213-475"><a href="#cb213-475" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span><span class="fu">is.na</span>(index) <span class="sc">&amp;</span> </span>
<span id="cb213-476"><a href="#cb213-476" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span>(index <span class="sc">%in%</span> tm<span class="sc">::</span><span class="fu">stopwords</span>()) <span class="sc">&amp;</span></span>
<span id="cb213-477"><a href="#cb213-477" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span>(index <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"vs"</span>, <span class="fu">tolower</span>(<span class="fu">as.roman</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)))))</span>
<span id="cb213-478"><a href="#cb213-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-479"><a href="#cb213-479" aria-hidden="true" tabindex="-1"></a>moore3 <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(nchar) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb213-480"><a href="#cb213-480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-481"><a href="#cb213-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-482"><a href="#cb213-482" aria-hidden="true" tabindex="-1"></a>I also included a dictionary, the Oxford Concise Color Medical Dictionary, 3rd edition from 2010. I also converted this epub to text using the same converter as above.</span>
<span id="cb213-483"><a href="#cb213-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-486"><a href="#cb213-486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-487"><a href="#cb213-487" aria-hidden="true" tabindex="-1"></a>oxford<span class="ot">&lt;-</span><span class="fu">read_file</span>(<span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/Oxford-Quick-Reference-Jonathan.txt"</span>)</span>
<span id="cb213-488"><a href="#cb213-488" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-489"><a href="#cb213-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-490"><a href="#cb213-490" aria-hidden="true" tabindex="-1"></a>Like the other 2 examples, words from the index.</span>
<span id="cb213-491"><a href="#cb213-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-494"><a href="#cb213-494" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-495"><a href="#cb213-495" aria-hidden="true" tabindex="-1"></a>oxford1<span class="ot">&lt;-</span><span class="fu">tibble</span>(<span class="at">dat =</span> oxford) <span class="sc">%&gt;%</span> </span>
<span id="cb213-496"><a href="#cb213-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">str_extract</span>(dat, <span class="st">"A &amp; E medicine[</span><span class="sc">\\</span><span class="st">s</span><span class="sc">\\</span><span class="st">S]+zymotic disease(?=</span><span class="sc">\\</span><span class="st">s{4}OXFORD QUICK)"</span>),<span class="co">#</span></span>
<span id="cb213-497"><a href="#cb213-497" aria-hidden="true" tabindex="-1"></a>         <span class="at">index1 =</span> <span class="fu">str_extract</span>(dat, <span class="st">"Affixesabdomin.[</span><span class="sc">\\</span><span class="st">s</span><span class="sc">\\</span><span class="st">S]+(?=a- </span><span class="sc">\\</span><span class="st">(an-</span><span class="sc">\\</span><span class="st">) prefix)"</span>),</span>
<span id="cb213-498"><a href="#cb213-498" aria-hidden="true" tabindex="-1"></a>         <span class="at">index1 =</span> <span class="fu">str_replace</span>(dat, <span class="st">"Affixesabdomin"</span>, <span class="st">"Affixes </span><span class="sc">\n\n</span><span class="st">abdomin"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-499"><a href="#cb213-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>dat) <span class="sc">%&gt;%</span> </span>
<span id="cb213-500"><a href="#cb213-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">values_to =</span> <span class="st">"index"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-501"><a href="#cb213-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb213-502"><a href="#cb213-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">str_split</span>(index, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-503"><a href="#cb213-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(index) <span class="sc">%&gt;%</span> </span>
<span id="cb213-504"><a href="#cb213-504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-505"><a href="#cb213-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(index))</span>
<span id="cb213-506"><a href="#cb213-506" aria-hidden="true" tabindex="-1"></a>oxford1<span class="ot">&lt;-</span>oxford1 <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">14</span><span class="sc">:</span> <span class="fu">nrow</span>(oxford1))</span>
<span id="cb213-507"><a href="#cb213-507" aria-hidden="true" tabindex="-1"></a>oxford1 <span class="sc">%&gt;%</span> head</span>
<span id="cb213-508"><a href="#cb213-508" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-509"><a href="#cb213-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-510"><a href="#cb213-510" aria-hidden="true" tabindex="-1"></a>I retrieved some affixes and abbreviations included here. I chose to remove them from the subset of words I'll use for the dictionary because with the fuzzy matching they match words that are from white noise on the page.</span>
<span id="cb213-511"><a href="#cb213-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-514"><a href="#cb213-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-515"><a href="#cb213-515" aria-hidden="true" tabindex="-1"></a>oxford_affix<span class="ot">&lt;-</span> oxford1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-516"><a href="#cb213-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(index, <span class="st">"^-</span><span class="sc">\\</span><span class="st">w+$|^</span><span class="sc">\\</span><span class="st">w+-$"</span>))</span>
<span id="cb213-517"><a href="#cb213-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-518"><a href="#cb213-518" aria-hidden="true" tabindex="-1"></a>oxford_abbrev <span class="ot">&lt;-</span> oxford1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-519"><a href="#cb213-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index2 =</span> <span class="fu">str_split</span>(index, <span class="st">"[[:punct:]</span><span class="sc">\\</span><span class="st">s]+"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-520"><a href="#cb213-520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(index2) <span class="sc">%&gt;%</span> </span>
<span id="cb213-521"><a href="#cb213-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(index2, <span class="st">"^[[:upper:]]{2,}$"</span>) <span class="sc">&amp;</span> </span>
<span id="cb213-522"><a href="#cb213-522" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span>(index2 <span class="sc">%in%</span> <span class="fu">as.roman</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)))</span>
<span id="cb213-523"><a href="#cb213-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-524"><a href="#cb213-524" aria-hidden="true" tabindex="-1"></a>oxford2<span class="ot">&lt;-</span> oxford1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-525"><a href="#cb213-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(.,oxford_abbrev) <span class="sc">%&gt;%</span> </span>
<span id="cb213-526"><a href="#cb213-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(index, <span class="st">"^-</span><span class="sc">\\</span><span class="st">w+$|^</span><span class="sc">\\</span><span class="st">w+-$"</span>) <span class="sc">&amp;</span> </span>
<span id="cb213-527"><a href="#cb213-527" aria-hidden="true" tabindex="-1"></a>           <span class="fu">is.na</span>(index2)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-528"><a href="#cb213-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>index2)</span>
<span id="cb213-529"><a href="#cb213-529" aria-hidden="true" tabindex="-1"></a>oxford2 <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">15</span>)</span>
<span id="cb213-530"><a href="#cb213-530" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-531"><a href="#cb213-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-532"><a href="#cb213-532" aria-hidden="true" tabindex="-1"></a>Like previously, I make multiple matching for possesive nouns.</span>
<span id="cb213-533"><a href="#cb213-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-536"><a href="#cb213-536" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-537"><a href="#cb213-537" aria-hidden="true" tabindex="-1"></a>oxford2<span class="ot">&lt;-</span> oxford2 <span class="sc">%&gt;%</span> </span>
<span id="cb213-538"><a href="#cb213-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">other0 =</span> <span class="fu">str_extract</span>(index, <span class="st">"</span><span class="sc">\\</span><span class="st">w+(?='s)"</span>),</span>
<span id="cb213-539"><a href="#cb213-539" aria-hidden="true" tabindex="-1"></a>         <span class="at">other =</span> <span class="fu">str_replace_all</span>(index, <span class="st">"[[:punct:]]"</span>, <span class="st">" "</span>),</span>
<span id="cb213-540"><a href="#cb213-540" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">str_replace_all</span>(., <span class="fu">c</span>(<span class="st">"[:punct:]+"</span><span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb213-541"><a href="#cb213-541" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span><span class="ot">=</span> <span class="st">""</span>))),</span>
<span id="cb213-542"><a href="#cb213-542" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">tolower</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb213-543"><a href="#cb213-543" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">values_to =</span> <span class="st">"index"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-544"><a href="#cb213-544" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb213-545"><a href="#cb213-545" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-546"><a href="#cb213-546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(index)) <span class="sc">%&gt;%</span> unique</span>
<span id="cb213-547"><a href="#cb213-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-548"><a href="#cb213-548" aria-hidden="true" tabindex="-1"></a>oxford2 <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">15</span>)</span>
<span id="cb213-549"><a href="#cb213-549" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-550"><a href="#cb213-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-551"><a href="#cb213-551" aria-hidden="true" tabindex="-1"></a>finally I remove stop words and roman numerials and strings shorter than 2 characters (for the same reason as before).</span>
<span id="cb213-552"><a href="#cb213-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-555"><a href="#cb213-555" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-556"><a href="#cb213-556" aria-hidden="true" tabindex="-1"></a>oxford3<span class="ot">&lt;-</span> oxford2 <span class="sc">%&gt;%</span> </span>
<span id="cb213-557"><a href="#cb213-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(index, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-558"><a href="#cb213-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-559"><a href="#cb213-559" aria-hidden="true" tabindex="-1"></a>  unique <span class="sc">%&gt;%</span> </span>
<span id="cb213-560"><a href="#cb213-560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nchar =</span> <span class="fu">nchar</span>(index))</span>
<span id="cb213-561"><a href="#cb213-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-562"><a href="#cb213-562" aria-hidden="true" tabindex="-1"></a>oxford3<span class="ot">&lt;-</span>oxford3 <span class="sc">%&gt;%</span> </span>
<span id="cb213-563"><a href="#cb213-563" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nchar <span class="sc">&gt;</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-564"><a href="#cb213-564" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(index <span class="sc">%in%</span> letters) <span class="sc">&amp;</span> </span>
<span id="cb213-565"><a href="#cb213-565" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span><span class="fu">is.na</span>(index) <span class="sc">&amp;</span> </span>
<span id="cb213-566"><a href="#cb213-566" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span>(index <span class="sc">%in%</span> tm<span class="sc">::</span><span class="fu">stopwords</span>()) <span class="sc">&amp;</span></span>
<span id="cb213-567"><a href="#cb213-567" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span>(index <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"vs"</span>, <span class="fu">tolower</span>(<span class="fu">as.roman</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)))))</span>
<span id="cb213-568"><a href="#cb213-568" aria-hidden="true" tabindex="-1"></a>oxford3 <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">15</span>)</span>
<span id="cb213-569"><a href="#cb213-569" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-570"><a href="#cb213-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-571"><a href="#cb213-571" aria-hidden="true" tabindex="-1"></a><span class="fu">### Applying Dictionaries</span></span>
<span id="cb213-572"><a href="#cb213-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-573"><a href="#cb213-573" aria-hidden="true" tabindex="-1"></a>In order to apply the dictionary, I first tokenize my corpus and save the tokens as a vector. I found that using vectors is faster than using a tibble. </span>
<span id="cb213-574"><a href="#cb213-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-577"><a href="#cb213-577" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-578"><a href="#cb213-578" aria-hidden="true" tabindex="-1"></a>dat2<span class="ot">&lt;-</span> dat1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-579"><a href="#cb213-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dat =</span> <span class="fu">strsplit</span>(dat, <span class="st">"."</span>, <span class="at">fixed =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb213-580"><a href="#cb213-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(dat) <span class="sc">%&gt;%</span> </span>
<span id="cb213-581"><a href="#cb213-581" aria-hidden="true" tabindex="-1"></a>  tidytext<span class="sc">::</span><span class="fu">unnest_tokens</span>(., <span class="st">"tokens"</span>, dat, </span>
<span id="cb213-582"><a href="#cb213-582" aria-hidden="true" tabindex="-1"></a>                          <span class="at">token =</span> <span class="st">"words"</span>, </span>
<span id="cb213-583"><a href="#cb213-583" aria-hidden="true" tabindex="-1"></a>                          <span class="at">format =</span> <span class="st">"text"</span>,</span>
<span id="cb213-584"><a href="#cb213-584" aria-hidden="true" tabindex="-1"></a>                          <span class="at">drop =</span> F) </span>
<span id="cb213-585"><a href="#cb213-585" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-586"><a href="#cb213-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-587"><a href="#cb213-587" aria-hidden="true" tabindex="-1"></a>Next I make a separate table where words can be checked against US, Australian, Canadian, and UK English dictionaries. I also make a medical dictionary comprised of the texts from the 2 timepoints and add it to the main dictionary.</span>
<span id="cb213-588"><a href="#cb213-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-591"><a href="#cb213-591" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-592"><a href="#cb213-592" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span> <span class="fu">unique</span>(dat2<span class="sc">$</span>tokens)</span>
<span id="cb213-593"><a href="#cb213-593" aria-hidden="true" tabindex="-1"></a><span class="co"># hunspell::list_dictionaries()</span></span>
<span id="cb213-594"><a href="#cb213-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-595"><a href="#cb213-595" aria-hidden="true" tabindex="-1"></a>dicts<span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">value =</span> temp,</span>
<span id="cb213-596"><a href="#cb213-596" aria-hidden="true" tabindex="-1"></a>              <span class="at">en_us =</span> <span class="fu">hunspell_check</span>(temp, </span>
<span id="cb213-597"><a href="#cb213-597" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">dict =</span> hunspell<span class="sc">::</span><span class="fu">dictionary</span>(<span class="st">"en_US"</span>)), </span>
<span id="cb213-598"><a href="#cb213-598" aria-hidden="true" tabindex="-1"></a>              <span class="at">en_au =</span> <span class="fu">hunspell_check</span>(temp, <span class="at">dict =</span> </span>
<span id="cb213-599"><a href="#cb213-599" aria-hidden="true" tabindex="-1"></a>                                       hunspell<span class="sc">::</span><span class="fu">dictionary</span>(<span class="st">"en_AU"</span>)),</span>
<span id="cb213-600"><a href="#cb213-600" aria-hidden="true" tabindex="-1"></a>              <span class="at">en_ca =</span> <span class="fu">hunspell_check</span>(temp, <span class="at">dict =</span> </span>
<span id="cb213-601"><a href="#cb213-601" aria-hidden="true" tabindex="-1"></a>                                       hunspell<span class="sc">::</span><span class="fu">dictionary</span>(<span class="st">"en_CA"</span>)),</span>
<span id="cb213-602"><a href="#cb213-602" aria-hidden="true" tabindex="-1"></a>              <span class="at">en_gb =</span> <span class="fu">hunspell_check</span>(temp, <span class="at">dict =</span> </span>
<span id="cb213-603"><a href="#cb213-603" aria-hidden="true" tabindex="-1"></a>                                       hunspell<span class="sc">::</span><span class="fu">dictionary</span>(<span class="st">"en_GB"</span>)))</span>
<span id="cb213-604"><a href="#cb213-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-605"><a href="#cb213-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-606"><a href="#cb213-606" aria-hidden="true" tabindex="-1"></a>med_dict<span class="ot">&lt;-</span> <span class="fu">rbind</span>(guten3, moore3, oxford3) <span class="sc">%&gt;%</span> </span>
<span id="cb213-607"><a href="#cb213-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>nchar, <span class="at">value =</span> index) <span class="sc">%&gt;%</span> </span>
<span id="cb213-608"><a href="#cb213-608" aria-hidden="true" tabindex="-1"></a>  unique</span>
<span id="cb213-609"><a href="#cb213-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-610"><a href="#cb213-610" aria-hidden="true" tabindex="-1"></a>dicts1<span class="ot">&lt;-</span> dicts <span class="sc">%&gt;%</span> </span>
<span id="cb213-611"><a href="#cb213-611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., med_dict <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">med =</span><span class="st">"med"</span>))</span>
<span id="cb213-612"><a href="#cb213-612" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-613"><a href="#cb213-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-614"><a href="#cb213-614" aria-hidden="true" tabindex="-1"></a>I first get a snapshot of the number of words that were marked as "good" by both the medical dictionaries and by hunspell. There are 3x more words that don't match the dictionaries than words that do.</span>
<span id="cb213-615"><a href="#cb213-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-618"><a href="#cb213-618" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-619"><a href="#cb213-619" aria-hidden="true" tabindex="-1"></a>dicts2<span class="ot">&lt;-</span> dicts1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-620"><a href="#cb213-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">med =</span> <span class="sc">!</span><span class="fu">is.na</span>(med)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-621"><a href="#cb213-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb213-622"><a href="#cb213-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(rowid, value), <span class="at">values_to =</span> <span class="st">"dict_sum"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-623"><a href="#cb213-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb213-624"><a href="#cb213-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">good =</span> <span class="fu">ifelse</span>(<span class="fu">any</span>(dict_sum), <span class="st">"yes"</span>, <span class="st">"no"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-625"><a href="#cb213-625" aria-hidden="true" tabindex="-1"></a>  ungroup</span>
<span id="cb213-626"><a href="#cb213-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-627"><a href="#cb213-627" aria-hidden="true" tabindex="-1"></a>dicts2 <span class="sc">%&gt;%</span> <span class="fu">count</span>(good)</span>
<span id="cb213-628"><a href="#cb213-628" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-629"><a href="#cb213-629" aria-hidden="true" tabindex="-1"></a><span class="fu">### Medical Dictionaries: Fuzzy Join</span></span>
<span id="cb213-630"><a href="#cb213-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-631"><a href="#cb213-631" aria-hidden="true" tabindex="-1"></a>In order to use fuzzy matching, I need to reduce the amount of time the algorithm takes because otherwise my computer crashes. One way I do this is by filtering a certain length of word. I first looked at the overall distribution of character lengths.</span>
<span id="cb213-632"><a href="#cb213-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-635"><a href="#cb213-635" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-636"><a href="#cb213-636" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fuzzyjoin)</span>
<span id="cb213-637"><a href="#cb213-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-638"><a href="#cb213-638" aria-hidden="true" tabindex="-1"></a>foo0<span class="ot">&lt;-</span> dicts2 <span class="sc">%&gt;%</span> </span>
<span id="cb213-639"><a href="#cb213-639" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(value, good) <span class="sc">%&gt;%</span> </span>
<span id="cb213-640"><a href="#cb213-640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb213-641"><a href="#cb213-641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nchar =</span> <span class="fu">nchar</span>(value))</span>
<span id="cb213-642"><a href="#cb213-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-643"><a href="#cb213-643" aria-hidden="true" tabindex="-1"></a>foo0 <span class="sc">%&gt;%</span> <span class="fu">pull</span>(nchar) <span class="sc">%&gt;%</span> log <span class="sc">%&gt;%</span> <span class="fu">hist</span>(., <span class="at">xlab =</span> <span class="st">"log(letters)"</span>, </span>
<span id="cb213-644"><a href="#cb213-644" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">main =</span> <span class="st">"Histogram of log(Letters) per Token"</span>)</span>
<span id="cb213-645"><a href="#cb213-645" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-646"><a href="#cb213-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-647"><a href="#cb213-647" aria-hidden="true" tabindex="-1"></a> I found that some of my words were just strings of characters. After discovering this and reviewing different lengths, I decided on a cutoff of 29 as there seemed to be no real words left in there.</span>
<span id="cb213-648"><a href="#cb213-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-651"><a href="#cb213-651" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-652"><a href="#cb213-652" aria-hidden="true" tabindex="-1"></a>foo0 <span class="sc">%&gt;%</span> </span>
<span id="cb213-653"><a href="#cb213-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nchar <span class="sc">&gt;</span><span class="dv">29</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-654"><a href="#cb213-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(nchar)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-655"><a href="#cb213-655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-656"><a href="#cb213-656" aria-hidden="true" tabindex="-1"></a>  kable</span>
<span id="cb213-657"><a href="#cb213-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-658"><a href="#cb213-658" aria-hidden="true" tabindex="-1"></a>foo<span class="ot">&lt;-</span>foo0<span class="sc">%&gt;%</span> </span>
<span id="cb213-659"><a href="#cb213-659" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(good <span class="sc">==</span> <span class="st">"no"</span> <span class="sc">&amp;</span> nchar <span class="sc">&lt;</span><span class="dv">29</span>)</span>
<span id="cb213-660"><a href="#cb213-660" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-661"><a href="#cb213-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-662"><a href="#cb213-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-663"><a href="#cb213-663" aria-hidden="true" tabindex="-1"></a>In order to join, I used the Longest Common Substring algorithm. this measures the number of characters you would need to add or delete to make 2 strings match. What is special about this algorithm compared to others is that it takes into account the order of the characters matched. This is important because many of my strings will have only 1 character misspelled, and the remainder of the word is the same. I also wanted to extra-penalize substitutions, and this gave a stronger selection than Levenshtein distance. I chose 2 because that gives room for either a substitution, 2 deletions, or 2 additions. I used this to join the medical dictionary.</span>
<span id="cb213-664"><a href="#cb213-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-665"><a href="#cb213-665" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = F}</span></span>
<span id="cb213-666"><a href="#cb213-666" aria-hidden="true" tabindex="-1"></a>joining <span class="ot">&lt;-</span> <span class="cf">function</span>(df, dict){</span>
<span id="cb213-667"><a href="#cb213-667" aria-hidden="true" tabindex="-1"></a>  df<span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb213-668"><a href="#cb213-668" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stringdist_left_join</span>(., dict, </span>
<span id="cb213-669"><a href="#cb213-669" aria-hidden="true" tabindex="-1"></a>                         <span class="at">method =</span> <span class="st">"lcs"</span>, </span>
<span id="cb213-670"><a href="#cb213-670" aria-hidden="true" tabindex="-1"></a>                         <span class="at">distance_col =</span> <span class="st">"dist"</span>,</span>
<span id="cb213-671"><a href="#cb213-671" aria-hidden="true" tabindex="-1"></a>                         <span class="at">max_dist =</span> <span class="dv">2</span>)</span>
<span id="cb213-672"><a href="#cb213-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb213-673"><a href="#cb213-673" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb213-674"><a href="#cb213-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-675"><a href="#cb213-675" aria-hidden="true" tabindex="-1"></a>corrections<span class="ot">&lt;-</span>foo <span class="sc">%&gt;%</span> </span>
<span id="cb213-676"><a href="#cb213-676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nchar <span class="sc">&gt;=</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-677"><a href="#cb213-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nchar) <span class="sc">%&gt;%</span> </span>
<span id="cb213-678"><a href="#cb213-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_split</span>()</span>
<span id="cb213-679"><a href="#cb213-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-680"><a href="#cb213-680" aria-hidden="true" tabindex="-1"></a>corrections<span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(corrections, <span class="sc">~</span><span class="fu">joining</span>(.x, med_dict))</span>
<span id="cb213-681"><a href="#cb213-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-682"><a href="#cb213-682" aria-hidden="true" tabindex="-1"></a><span class="co"># save(corrections, file="/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/medcorrections.RData")</span></span>
<span id="cb213-683"><a href="#cb213-683" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-684"><a href="#cb213-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-685"><a href="#cb213-685" aria-hidden="true" tabindex="-1"></a>I then counted the number of matches to the original value, and how many matches were at a given distance.</span>
<span id="cb213-686"><a href="#cb213-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-689"><a href="#cb213-689" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-690"><a href="#cb213-690" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/medcorrections.RData"</span>)</span>
<span id="cb213-691"><a href="#cb213-691" aria-hidden="true" tabindex="-1"></a>corrections1<span class="ot">&lt;-</span> corrections <span class="sc">%&gt;%</span> </span>
<span id="cb213-692"><a href="#cb213-692" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(value.x, <span class="at">name =</span> <span class="st">"n_matches"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb213-693"><a href="#cb213-693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(value.x, dist, <span class="at">name =</span> <span class="st">"n_matches_at_dist"</span>)</span>
<span id="cb213-694"><a href="#cb213-694" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb213-695"><a href="#cb213-695" aria-hidden="true" tabindex="-1"></a>corrections1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-696"><a href="#cb213-696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(n_matches, dist, n_matches_at_dist, <span class="fu">is.na</span>(value.y)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-697"><a href="#cb213-697" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-698"><a href="#cb213-698" aria-hidden="true" tabindex="-1"></a>  kable</span>
<span id="cb213-699"><a href="#cb213-699" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-700"><a href="#cb213-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-701"><a href="#cb213-701" aria-hidden="true" tabindex="-1"></a>In order to choose the best replacement word, I chose words with only 1 match, or if there were multiple options, only the word at the shortest distance. I then added these changes to the collection of tokens as "changeme".</span>
<span id="cb213-702"><a href="#cb213-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-705"><a href="#cb213-705" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-706"><a href="#cb213-706" aria-hidden="true" tabindex="-1"></a>corrections2<span class="ot">&lt;-</span> corrections1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-707"><a href="#cb213-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">keep =</span> <span class="fu">case_when</span>(</span>
<span id="cb213-708"><a href="#cb213-708" aria-hidden="true" tabindex="-1"></a>    n_matches <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(dist) <span class="sc">~</span> <span class="st">"yes"</span>,</span>
<span id="cb213-709"><a href="#cb213-709" aria-hidden="true" tabindex="-1"></a>    dist <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> n_matches_at_dist <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"yes"</span>,</span>
<span id="cb213-710"><a href="#cb213-710" aria-hidden="true" tabindex="-1"></a>    T<span class="sc">~</span><span class="st">"no"</span></span>
<span id="cb213-711"><a href="#cb213-711" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb213-712"><a href="#cb213-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(keep <span class="sc">==</span> <span class="st">"yes"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-713"><a href="#cb213-713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">value =</span> value.x, value.y) <span class="sc">%&gt;%</span> </span>
<span id="cb213-714"><a href="#cb213-714" aria-hidden="true" tabindex="-1"></a>  unique</span>
<span id="cb213-715"><a href="#cb213-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-716"><a href="#cb213-716" aria-hidden="true" tabindex="-1"></a>dicts3<span class="ot">&lt;-</span> dicts2 <span class="sc">%&gt;%</span> </span>
<span id="cb213-717"><a href="#cb213-717" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(value, good) <span class="sc">%&gt;%</span> </span>
<span id="cb213-718"><a href="#cb213-718" aria-hidden="true" tabindex="-1"></a>  unique</span>
<span id="cb213-719"><a href="#cb213-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-720"><a href="#cb213-720" aria-hidden="true" tabindex="-1"></a>dicts3<span class="ot">&lt;-</span> dicts3 <span class="sc">%&gt;%</span> </span>
<span id="cb213-721"><a href="#cb213-721" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., corrections2) <span class="sc">%&gt;%</span> </span>
<span id="cb213-722"><a href="#cb213-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">good =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(value.y.y), <span class="st">"changeme"</span>, good))</span>
<span id="cb213-723"><a href="#cb213-723" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb213-724"><a href="#cb213-724" aria-hidden="true" tabindex="-1"></a>dicts3 <span class="sc">%&gt;%</span> <span class="fu">count</span>(good)</span>
<span id="cb213-725"><a href="#cb213-725" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-726"><a href="#cb213-726" aria-hidden="true" tabindex="-1"></a>At this point I realized that words above 25 characters weren't actually words so I removed them if they weren't recognized as words in the first place.</span>
<span id="cb213-727"><a href="#cb213-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-730"><a href="#cb213-730" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-731"><a href="#cb213-731" aria-hidden="true" tabindex="-1"></a>dicts4<span class="ot">&lt;-</span> dicts3 <span class="sc">%&gt;%</span> </span>
<span id="cb213-732"><a href="#cb213-732" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nchar =</span> <span class="fu">nchar</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-733"><a href="#cb213-733" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(nchar <span class="sc">&gt;</span> <span class="dv">25</span> <span class="sc">&amp;</span> good <span class="sc">==</span> <span class="st">"no"</span>))</span>
<span id="cb213-734"><a href="#cb213-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-735"><a href="#cb213-735" aria-hidden="true" tabindex="-1"></a>dicts4 <span class="sc">%&gt;%</span> <span class="fu">count</span>(good)</span>
<span id="cb213-736"><a href="#cb213-736" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-737"><a href="#cb213-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-738"><a href="#cb213-738" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hunspell Dictionary: Stringdist</span></span>
<span id="cb213-739"><a href="#cb213-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-740"><a href="#cb213-740" aria-hidden="true" tabindex="-1"></a>This next part was a lot more difficult because hunspell takes a lot longer than just fuzzy joining. I first looked at the distribution of the remaining mispelled characters.</span>
<span id="cb213-741"><a href="#cb213-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-744"><a href="#cb213-744" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-745"><a href="#cb213-745" aria-hidden="true" tabindex="-1"></a>morefoo<span class="ot">&lt;-</span> dicts4 <span class="sc">%&gt;%</span> </span>
<span id="cb213-746"><a href="#cb213-746" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(value, good) <span class="sc">%&gt;%</span> </span>
<span id="cb213-747"><a href="#cb213-747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb213-748"><a href="#cb213-748" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nchar =</span> <span class="fu">nchar</span>(value))</span>
<span id="cb213-749"><a href="#cb213-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-750"><a href="#cb213-750" aria-hidden="true" tabindex="-1"></a>morefoo1<span class="ot">&lt;-</span>morefoo<span class="sc">%&gt;%</span> </span>
<span id="cb213-751"><a href="#cb213-751" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(good <span class="sc">==</span> <span class="st">"no"</span> <span class="sc">&amp;</span> nchar <span class="sc">&lt;</span><span class="dv">14</span> <span class="sc">&amp;</span> nchar <span class="sc">&gt;</span> <span class="dv">3</span>)</span>
<span id="cb213-752"><a href="#cb213-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-753"><a href="#cb213-753" aria-hidden="true" tabindex="-1"></a>morefoo<span class="sc">%&gt;%</span> <span class="fu">count</span>(nchar)</span>
<span id="cb213-754"><a href="#cb213-754" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-755"><a href="#cb213-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-756"><a href="#cb213-756" aria-hidden="true" tabindex="-1"></a>As strings get longer, it takes hunspell much longer to parse them. Words under 4 characters were less accurately matched. I decided to use a range from 4-14 for the first round (as this takes a long time to process). I selected the first word from hunspell's recommended words since that was the best estimate of what the word could have meant.</span>
<span id="cb213-757"><a href="#cb213-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-758"><a href="#cb213-758" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = F}</span></span>
<span id="cb213-759"><a href="#cb213-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-760"><a href="#cb213-760" aria-hidden="true" tabindex="-1"></a><span class="co"># this function is taken from https://stackoverflow.com/questions/3318333/split-a-vector-into-chunks</span></span>
<span id="cb213-761"><a href="#cb213-761" aria-hidden="true" tabindex="-1"></a>chunk <span class="ot">&lt;-</span> <span class="cf">function</span>(x, n) <span class="fu">split</span>(x, <span class="fu">sort</span>(<span class="fu">rank</span>(x) <span class="sc">%%</span> n))</span>
<span id="cb213-762"><a href="#cb213-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-763"><a href="#cb213-763" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span> morefoo1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-764"><a href="#cb213-764" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb213-765"><a href="#cb213-765" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span>  </span>
<span id="cb213-766"><a href="#cb213-766" aria-hidden="true" tabindex="-1"></a>  <span class="fu">chunk</span>(., <span class="at">n =</span> <span class="dv">84</span>)</span>
<span id="cb213-767"><a href="#cb213-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-768"><a href="#cb213-768" aria-hidden="true" tabindex="-1"></a>hunspell_function<span class="ot">&lt;-</span> <span class="cf">function</span>(wordlist){</span>
<span id="cb213-769"><a href="#cb213-769" aria-hidden="true" tabindex="-1"></a>  wah<span class="ot">&lt;-</span> <span class="fu">hunspell_suggest</span>(wordlist)</span>
<span id="cb213-770"><a href="#cb213-770" aria-hidden="true" tabindex="-1"></a>  wee<span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">value =</span> wordlist,</span>
<span id="cb213-771"><a href="#cb213-771" aria-hidden="true" tabindex="-1"></a>               <span class="at">sugg =</span> wah) <span class="sc">%&gt;%</span> </span>
<span id="cb213-772"><a href="#cb213-772" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_longer</span>(sugg) <span class="sc">%&gt;%</span> </span>
<span id="cb213-773"><a href="#cb213-773" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb213-774"><a href="#cb213-774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-775"><a href="#cb213-775" aria-hidden="true" tabindex="-1"></a>  ungroup</span>
<span id="cb213-776"><a href="#cb213-776" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb213-777"><a href="#cb213-777" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(wee)</span>
<span id="cb213-778"><a href="#cb213-778" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb213-779"><a href="#cb213-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-780"><a href="#cb213-780" aria-hidden="true" tabindex="-1"></a>weeha<span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(temp, <span class="sc">~</span>{</span>
<span id="cb213-781"><a href="#cb213-781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"hmm"</span>)</span>
<span id="cb213-782"><a href="#cb213-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hunspell_function</span>(.x)</span>
<span id="cb213-783"><a href="#cb213-783" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb213-784"><a href="#cb213-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-785"><a href="#cb213-785" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(weeha, <span class="at">file =</span> <span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/hunspellcorrections.RData"</span>)</span>
<span id="cb213-786"><a href="#cb213-786" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-787"><a href="#cb213-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-788"><a href="#cb213-788" aria-hidden="true" tabindex="-1"></a>Next I did values in the upper ranges.</span>
<span id="cb213-789"><a href="#cb213-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-790"><a href="#cb213-790" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = F}</span></span>
<span id="cb213-791"><a href="#cb213-791" aria-hidden="true" tabindex="-1"></a>morefoo1<span class="ot">&lt;-</span>morefoo<span class="sc">%&gt;%</span> </span>
<span id="cb213-792"><a href="#cb213-792" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(good <span class="sc">==</span> <span class="st">"no"</span> <span class="sc">&amp;</span> nchar <span class="sc">&gt;</span> <span class="dv">14</span> )</span>
<span id="cb213-793"><a href="#cb213-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-794"><a href="#cb213-794" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span> morefoo1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-795"><a href="#cb213-795" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb213-796"><a href="#cb213-796" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span>  </span>
<span id="cb213-797"><a href="#cb213-797" aria-hidden="true" tabindex="-1"></a>  <span class="fu">chunk</span>(., <span class="at">n =</span> <span class="dv">2</span>)</span>
<span id="cb213-798"><a href="#cb213-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-799"><a href="#cb213-799" aria-hidden="true" tabindex="-1"></a>upper<span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(temp, <span class="sc">~</span>{</span>
<span id="cb213-800"><a href="#cb213-800" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"hmm"</span>)</span>
<span id="cb213-801"><a href="#cb213-801" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hunspell_function</span>(.x)</span>
<span id="cb213-802"><a href="#cb213-802" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb213-803"><a href="#cb213-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-804"><a href="#cb213-804" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(upper, <span class="at">file =</span> <span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/hunspellcorrections_upper.RData"</span>)</span>
<span id="cb213-805"><a href="#cb213-805" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-806"><a href="#cb213-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-809"><a href="#cb213-809" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-810"><a href="#cb213-810" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/hunspellcorrections_upper.RData"</span>)</span>
<span id="cb213-811"><a href="#cb213-811" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/hunspellcorrections.RData"</span>)</span>
<span id="cb213-812"><a href="#cb213-812" aria-hidden="true" tabindex="-1"></a>upper <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span>
<span id="cb213-813"><a href="#cb213-813" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-814"><a href="#cb213-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-815"><a href="#cb213-815" aria-hidden="true" tabindex="-1"></a>I then used stringdist to calculate the LCS distance of each suggestion.</span>
<span id="cb213-816"><a href="#cb213-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-819"><a href="#cb213-819" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-820"><a href="#cb213-820" aria-hidden="true" tabindex="-1"></a>weeha1<span class="ot">&lt;-</span> weeha <span class="sc">%&gt;%</span> </span>
<span id="cb213-821"><a href="#cb213-821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(., upper)</span>
<span id="cb213-822"><a href="#cb213-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-823"><a href="#cb213-823" aria-hidden="true" tabindex="-1"></a>weeha2<span class="ot">&lt;-</span> weeha1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-824"><a href="#cb213-824" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> stringdist<span class="sc">::</span><span class="fu">stringdist</span>(value, sugg, </span>
<span id="cb213-825"><a href="#cb213-825" aria-hidden="true" tabindex="-1"></a>                           <span class="at">method =</span> <span class="st">"lcs"</span></span>
<span id="cb213-826"><a href="#cb213-826" aria-hidden="true" tabindex="-1"></a>                           ))</span>
<span id="cb213-827"><a href="#cb213-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-828"><a href="#cb213-828" aria-hidden="true" tabindex="-1"></a><span class="co"># weeha1 %&gt;% filter(dist == 3) %&gt;% View</span></span>
<span id="cb213-829"><a href="#cb213-829" aria-hidden="true" tabindex="-1"></a>weeha2 <span class="sc">%&gt;%</span> <span class="fu">count</span>(dist) <span class="sc">%&gt;%</span> head</span>
<span id="cb213-830"><a href="#cb213-830" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-831"><a href="#cb213-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-832"><a href="#cb213-832" aria-hidden="true" tabindex="-1"></a>I decided to remain consistent with earlier datasets and only use a distance of 2.</span>
<span id="cb213-833"><a href="#cb213-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-836"><a href="#cb213-836" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-837"><a href="#cb213-837" aria-hidden="true" tabindex="-1"></a>weeha3<span class="ot">&lt;-</span> weeha2 <span class="sc">%&gt;%</span> </span>
<span id="cb213-838"><a href="#cb213-838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dist <span class="sc">&lt;</span><span class="dv">3</span>)</span>
<span id="cb213-839"><a href="#cb213-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-840"><a href="#cb213-840" aria-hidden="true" tabindex="-1"></a>weeha3 <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(value)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span>
<span id="cb213-841"><a href="#cb213-841" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-842"><a href="#cb213-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-843"><a href="#cb213-843" aria-hidden="true" tabindex="-1"></a>I next added it to the dictionary.</span>
<span id="cb213-844"><a href="#cb213-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-847"><a href="#cb213-847" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-848"><a href="#cb213-848" aria-hidden="true" tabindex="-1"></a>dicts5<span class="ot">&lt;-</span>dicts4 <span class="sc">%&gt;%</span> </span>
<span id="cb213-849"><a href="#cb213-849" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., weeha3) <span class="sc">%&gt;%</span> </span>
<span id="cb213-850"><a href="#cb213-850" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">good =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(sugg), <span class="st">"changeme1"</span>, good))</span>
<span id="cb213-851"><a href="#cb213-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-852"><a href="#cb213-852" aria-hidden="true" tabindex="-1"></a>dicts5 <span class="sc">%&gt;%</span> <span class="fu">count</span>(good)</span>
<span id="cb213-853"><a href="#cb213-853" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-854"><a href="#cb213-854" aria-hidden="true" tabindex="-1"></a>Lastly, I decided to see how many words contained medical affixes that I obtained from the Oxford dictionary. I used regex_join to see if any matched.</span>
<span id="cb213-855"><a href="#cb213-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-856"><a href="#cb213-856" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = F}</span></span>
<span id="cb213-857"><a href="#cb213-857" aria-hidden="true" tabindex="-1"></a>tempo<span class="ot">&lt;-</span> oxford_affix <span class="sc">%&gt;%</span> </span>
<span id="cb213-858"><a href="#cb213-858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(index) <span class="sc">&gt;</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-859"><a href="#cb213-859" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">trimws</span>(index, <span class="at">which=</span><span class="st">"both"</span>),</span>
<span id="cb213-860"><a href="#cb213-860" aria-hidden="true" tabindex="-1"></a>         <span class="at">index =</span> <span class="fu">str_replace_all</span>(index, <span class="fu">c</span>(<span class="st">"^-"</span> <span class="ot">=</span> <span class="st">"^"</span>,</span>
<span id="cb213-861"><a href="#cb213-861" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"-$"</span> <span class="ot">=</span> <span class="st">".{0,3}$"</span>)),</span>
<span id="cb213-862"><a href="#cb213-862" aria-hidden="true" tabindex="-1"></a>         <span class="at">matches =</span> <span class="st">"yes"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-863"><a href="#cb213-863" aria-hidden="true" tabindex="-1"></a>  unique <span class="sc">%&gt;%</span> </span>
<span id="cb213-864"><a href="#cb213-864" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">value =</span> index)</span>
<span id="cb213-865"><a href="#cb213-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-866"><a href="#cb213-866" aria-hidden="true" tabindex="-1"></a>fee<span class="ot">&lt;-</span> dicts5 <span class="sc">%&gt;%</span> </span>
<span id="cb213-867"><a href="#cb213-867" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(good <span class="sc">==</span> <span class="st">"no"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb213-868"><a href="#cb213-868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(value)</span>
<span id="cb213-869"><a href="#cb213-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-870"><a href="#cb213-870" aria-hidden="true" tabindex="-1"></a>fee1<span class="ot">&lt;-</span> <span class="fu">regex_left_join</span>(fee, tempo)</span>
<span id="cb213-871"><a href="#cb213-871" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(fee1, <span class="at">file=</span><span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/affixes.RData"</span>)</span>
<span id="cb213-872"><a href="#cb213-872" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-873"><a href="#cb213-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-874"><a href="#cb213-874" aria-hidden="true" tabindex="-1"></a>I use this as a way of stemming and I replace the word with it. I assume that the stem captures part of the meaning of the original word, and stemming will be done anyway for the word cloud. I couldn't use hunspell as a stemmer because it kept producing NAs so this is the only way that I thought I could for these words.</span>
<span id="cb213-875"><a href="#cb213-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-878"><a href="#cb213-878" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-879"><a href="#cb213-879" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/affixes.RData"</span>)</span>
<span id="cb213-880"><a href="#cb213-880" aria-hidden="true" tabindex="-1"></a>fee2<span class="ot">&lt;-</span> fee1 <span class="sc">%&gt;%</span> </span>
<span id="cb213-881"><a href="#cb213-881" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(matches)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-882"><a href="#cb213-882" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">value =</span> value.x, <span class="at">repl =</span> value.y) <span class="sc">%&gt;%</span> </span>
<span id="cb213-883"><a href="#cb213-883" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">repl =</span> <span class="fu">str_remove_all</span>(repl, <span class="st">"^|</span><span class="sc">\\</span><span class="st">.[[:punct:]]</span><span class="sc">\\</span><span class="st">d</span><span class="sc">\\</span><span class="st">,</span><span class="sc">\\</span><span class="st">d.."</span>))</span>
<span id="cb213-884"><a href="#cb213-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-885"><a href="#cb213-885" aria-hidden="true" tabindex="-1"></a>fee1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(matches)) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">15</span>)</span>
<span id="cb213-886"><a href="#cb213-886" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-887"><a href="#cb213-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-888"><a href="#cb213-888" aria-hidden="true" tabindex="-1"></a>Next, I add these stems to the dictionary and create a column of replacements. I also remove words that are 2-3 letters long because of reasons I mentioned previosly. Only a few thousand are removed.</span>
<span id="cb213-889"><a href="#cb213-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-892"><a href="#cb213-892" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-893"><a href="#cb213-893" aria-hidden="true" tabindex="-1"></a>dicts6<span class="ot">&lt;-</span> dicts5 <span class="sc">%&gt;%</span> </span>
<span id="cb213-894"><a href="#cb213-894" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(fee2) <span class="sc">%&gt;%</span> </span>
<span id="cb213-895"><a href="#cb213-895" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">good =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(repl), <span class="st">"changeme2"</span>, good))</span>
<span id="cb213-896"><a href="#cb213-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-897"><a href="#cb213-897" aria-hidden="true" tabindex="-1"></a>dicts6<span class="ot">&lt;-</span>dicts6 <span class="sc">%&gt;%</span> </span>
<span id="cb213-898"><a href="#cb213-898" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nchar =</span> <span class="fu">nchar</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-899"><a href="#cb213-899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">change =</span> <span class="fu">case_when</span>(</span>
<span id="cb213-900"><a href="#cb213-900" aria-hidden="true" tabindex="-1"></a>    good <span class="sc">==</span> <span class="st">"yes"</span> <span class="sc">~</span> value,</span>
<span id="cb213-901"><a href="#cb213-901" aria-hidden="true" tabindex="-1"></a>    good <span class="sc">==</span> <span class="st">"changeme"</span><span class="sc">~</span> value.y.y,</span>
<span id="cb213-902"><a href="#cb213-902" aria-hidden="true" tabindex="-1"></a>    good <span class="sc">==</span> <span class="st">"changeme1"</span> <span class="sc">~</span> sugg,</span>
<span id="cb213-903"><a href="#cb213-903" aria-hidden="true" tabindex="-1"></a>    good <span class="sc">==</span> <span class="st">"changeme2"</span> <span class="sc">~</span> repl,</span>
<span id="cb213-904"><a href="#cb213-904" aria-hidden="true" tabindex="-1"></a>    nchar <span class="sc">==</span><span class="dv">2</span> <span class="sc">&amp;</span> <span class="sc">!</span>(value <span class="sc">%in%</span> tm<span class="sc">::</span><span class="fu">stopwords</span>()) <span class="sc">~</span> <span class="cn">NA_character_</span>,</span>
<span id="cb213-905"><a href="#cb213-905" aria-hidden="true" tabindex="-1"></a>    T <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb213-906"><a href="#cb213-906" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb213-907"><a href="#cb213-907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">tokens =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb213-908"><a href="#cb213-908" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(tokens, change)</span>
<span id="cb213-909"><a href="#cb213-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-910"><a href="#cb213-910" aria-hidden="true" tabindex="-1"></a>dicts5 <span class="sc">%&gt;%</span> </span>
<span id="cb213-911"><a href="#cb213-911" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nchar =</span> <span class="fu">nchar</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb213-912"><a href="#cb213-912" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">foo=</span>(nchar <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>) <span class="sc">&amp;</span> good <span class="sc">==</span> <span class="st">"no"</span>))</span>
<span id="cb213-913"><a href="#cb213-913" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-914"><a href="#cb213-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-915"><a href="#cb213-915" aria-hidden="true" tabindex="-1"></a>Finally, I use the dictionary I made in order to clean the corpus. Below are examples of cleaned lines.</span>
<span id="cb213-916"><a href="#cb213-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-919"><a href="#cb213-919" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-920"><a href="#cb213-920" aria-hidden="true" tabindex="-1"></a>dat3<span class="ot">&lt;-</span> dat2 <span class="sc">%&gt;%</span> </span>
<span id="cb213-921"><a href="#cb213-921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(., dicts6) <span class="sc">%&gt;%</span> </span>
<span id="cb213-922"><a href="#cb213-922" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(change)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-923"><a href="#cb213-923" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(titles, dates, edition, volume, part, type, page, dat) <span class="sc">%&gt;%</span></span>
<span id="cb213-924"><a href="#cb213-924" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">temp =</span> <span class="fu">paste0</span>(<span class="fu">na.omit</span>(change), <span class="at">collapse =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb213-925"><a href="#cb213-925" aria-hidden="true" tabindex="-1"></a>  ungroup</span>
<span id="cb213-926"><a href="#cb213-926" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb213-927"><a href="#cb213-927" aria-hidden="true" tabindex="-1"></a><span class="co"># save(dat3, file = "/Users/emmanuelmiller/Desktop/dacss697d/Text_as_Data_Fall_2022/posts/_data/dat3.RData")</span></span>
<span id="cb213-928"><a href="#cb213-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-929"><a href="#cb213-929" aria-hidden="true" tabindex="-1"></a>dat3 <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">110</span>)</span>
<span id="cb213-930"><a href="#cb213-930" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-931"><a href="#cb213-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-932"><a href="#cb213-932" aria-hidden="true" tabindex="-1"></a><span class="fu"># Word Cloud</span></span>
<span id="cb213-933"><a href="#cb213-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-934"><a href="#cb213-934" aria-hidden="true" tabindex="-1"></a>In order to visualize my results, I remove stop words and stem.</span>
<span id="cb213-935"><a href="#cb213-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-938"><a href="#cb213-938" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-939"><a href="#cb213-939" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span>
<span id="cb213-940"><a href="#cb213-940" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textplots)</span>
<span id="cb213-941"><a href="#cb213-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-942"><a href="#cb213-942" aria-hidden="true" tabindex="-1"></a>hmm<span class="ot">&lt;-</span> <span class="fu">corpus</span>(dat3<span class="sc">$</span>temp)</span>
<span id="cb213-943"><a href="#cb213-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-944"><a href="#cb213-944" aria-hidden="true" tabindex="-1"></a><span class="fu">docvars</span>(hmm)<span class="ot">&lt;-</span> dat3 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>dat, <span class="sc">-</span>temp)</span>
<span id="cb213-945"><a href="#cb213-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-946"><a href="#cb213-946" aria-hidden="true" tabindex="-1"></a>hmm_tok<span class="ot">&lt;-</span> <span class="fu">tokens</span>(hmm)</span>
<span id="cb213-947"><a href="#cb213-947" aria-hidden="true" tabindex="-1"></a>hmm_tok0<span class="ot">&lt;-</span><span class="fu">tokens_remove</span>(hmm_tok, <span class="at">pattern =</span> <span class="fu">stopwords</span>(<span class="st">"en"</span>))</span>
<span id="cb213-948"><a href="#cb213-948" aria-hidden="true" tabindex="-1"></a>hmm_tok0<span class="ot">&lt;-</span><span class="fu">tokens_remove</span>(hmm_tok0, <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">"fig"</span>, <span class="st">"et"</span>))</span>
<span id="cb213-949"><a href="#cb213-949" aria-hidden="true" tabindex="-1"></a>hmm_tok1 <span class="ot">&lt;-</span> <span class="fu">tokens_wordstem</span>(hmm_tok0)</span>
<span id="cb213-950"><a href="#cb213-950" aria-hidden="true" tabindex="-1"></a>hmm_dfm<span class="ot">&lt;-</span> <span class="fu">dfm</span>(hmm_tok1) </span>
<span id="cb213-951"><a href="#cb213-951" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb213-952"><a href="#cb213-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-953"><a href="#cb213-953" aria-hidden="true" tabindex="-1"></a>Below is a wordcloud of my whole corpus. I notice that the word "may" is one of the most frequent. This is likely because "may" indicates uncertainty and is frequently used in scientific publications. For this reason, I don't necessarily consider it a stopword.</span>
<span id="cb213-954"><a href="#cb213-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-957"><a href="#cb213-957" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb213-958"><a href="#cb213-958" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_wordcloud</span>(hmm_dfm, <span class="at">max_words =</span> <span class="dv">50</span>)</span>
<span id="cb213-959"><a href="#cb213-959" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>