{
  "hash": "3c380c683df5b395936fe8d427b50e95",
  "result": {
    "markdown": "---\ntitle: \"Text as Data Final Project\"\nauthor: \"Quinn He\"\ndesription: \"Research project\"\ndate: \"10/19/2022\"\nformat:\n  html:\n    toc: true\n    code-fold: true\n    code-copy: true\n    code-tools: true\ncategories:\n  - Blog Post 2\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(RedditExtractoR)\nlibrary(syuzhet)\nlibrary(rvest)\nlibrary(quanteda)\nlibrary(quanteda.textplots)\nlibrary(polite)\nlibrary(cleanNLP)\n\nknitr::opts_chunk$set(echo = TRUE)\n```\n:::\n\n\n## Research Question\n\nCompare how two subreddits (/r/republicans and /r/democrats) discuss particular political issues. With this it may be difficult because the democrat subreddit has a far superior user base. \n\nI think I will have to actually scrape reddit for the comments at least because I cannot find the command to get comments of posts. I am able to get the titles of posts and how many comments they have, but I want to analze the discourse of the comments as well. \n\nShould I do something with /r/conspiracy?\n\nIf I choose to look into rhetoric on the ukraine/russian war, I would have to pick different subreddits because there were little to no posts in subreddit titles. \n\nWhat words do they tend to use over the opposition?\n\nBelow I am pulling data from the two subreddits below. As of now, these two subreddits will be my focus for analysis. \n\n::: {.cell}\n\n```{.r .cell-code}\nred <- find_thread_urls(subreddit = \"republicans\", sort_by = \"top\", period = \"month\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nparsing URLs on page 1...\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in file(con, \"r\"): cannot open URL 'https://www.reddit.com/r/\nrepublicans/top.json?t=month&limit=100': HTTP status was '429 Unknown Error'\n```\n:::\n\n::: {.cell-output .cell-output-error}\n```\nError in value[[3L]](cond): Cannot read from Reddit, check your inputs or internet connection\n```\n:::\n\n```{.r .cell-code}\nblue <- find_thread_urls(subreddit = \"democrats\", sort_by = \"top\", period = \"month\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nparsing URLs on page 1...\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in file(con, \"r\"): cannot open URL 'https://www.reddit.com/r/democrats/\ntop.json?t=month&limit=100': HTTP status was '429 Unknown Error'\n```\n:::\n\n::: {.cell-output .cell-output-error}\n```\nError in value[[3L]](cond): Cannot read from Reddit, check your inputs or internet connection\n```\n:::\n:::\n\nWord cloud for /r/democrats titles\n\n::: {.cell}\n\n```{.r .cell-code}\nblue_corpus <- corpus(blue$title)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in corpus(blue$title): object 'blue' not found\n```\n:::\n\n```{.r .cell-code}\nblue_tokens <- tokens(blue_corpus,\n                      remove_punct = T,\n                      remove_numbers = T)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in tokens(blue_corpus, remove_punct = T, remove_numbers = T): object 'blue_corpus' not found\n```\n:::\n\n```{.r .cell-code}\nblue_tokens <- tokens_select(blue_tokens,\n                             pattern = stopwords(\"en\"),\n                             selection = \"remove\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in tokens_select(blue_tokens, pattern = stopwords(\"en\"), selection = \"remove\"): object 'blue_tokens' not found\n```\n:::\n\n```{.r .cell-code}\nblue_dfm <- dfm(blue_tokens)%>% \n  dfm_trim(min_termfreq = 3)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in dfm(blue_tokens): object 'blue_tokens' not found\n```\n:::\n\n```{.r .cell-code}\ntextplot_wordcloud(blue_dfm, max_words = 100, color = \"blue\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in textplot_wordcloud(blue_dfm, max_words = 100, color = \"blue\"): object 'blue_dfm' not found\n```\n:::\n:::\n\nWord cloud for /r/republicans titles\n\n::: {.cell}\n\n```{.r .cell-code}\nred_corpus <- corpus(red$title)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in corpus(red$title): object 'red' not found\n```\n:::\n\n```{.r .cell-code}\nred_tokens <- tokens(red_corpus,\n                      remove_punct = T,\n                      remove_numbers = T)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in tokens(red_corpus, remove_punct = T, remove_numbers = T): object 'red_corpus' not found\n```\n:::\n\n```{.r .cell-code}\nred_tokens <- tokens_select(red_tokens,\n                             pattern = stopwords(\"en\"),\n                             selection = \"remove\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in tokens_select(red_tokens, pattern = stopwords(\"en\"), selection = \"remove\"): object 'red_tokens' not found\n```\n:::\n\n```{.r .cell-code}\nred_dfm <- dfm(red_tokens) %>% \n  dfm_trim(min_termfreq = 3)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in dfm(red_tokens): object 'red_tokens' not found\n```\n:::\n\n```{.r .cell-code}\ntextplot_wordcloud(red_dfm, max_words = 100, color = \"red\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in textplot_wordcloud(red_dfm, max_words = 100, color = \"red\"): object 'red_dfm' not found\n```\n:::\n:::\n\n\nThis only gets the titles of the recent posts on the subreddit, but for now I will use it to just run sentiment analysis on that.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nred_title_sent <- get_nrc_sentiment(red$title)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in get_nrc_sentiment(red$title): object 'red' not found\n```\n:::\n\n```{.r .cell-code}\nblue_title_sent <- get_nrc_sentiment(blue$title)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in get_nrc_sentiment(blue$title): object 'blue' not found\n```\n:::\n\n```{.r .cell-code}\nred_title_sent <- cbind(red_title_sent, red)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in cbind(red_title_sent, red): object 'red_title_sent' not found\n```\n:::\n\n```{.r .cell-code}\nblue_title_sent <- cbind(blue_title_sent, blue)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in cbind(blue_title_sent, blue): object 'blue_title_sent' not found\n```\n:::\n:::\n\n\n## Getting the comments from posts\n\nRight now, I am only taking comments from posts I see on the front page with more than 10 comments, just to test this method. In the future I will have to determine a topic that I can track between both subreddits in order to get a sentiment that is comparable.\n\n::: {.cell}\n\n```{.r .cell-code}\nblue_url <- c(\"https://www.reddit.com/r/democrats/comments/ye13dt/the_midterms_are_a_referendum_on_democracy_in/\",\n              \"https://www.reddit.com/r/democrats/comments/ydqws7/vote_fetterman/\",\n              \"https://www.reddit.com/r/democrats/comments/ye1vqa/republicans_denounce_inflation_but_few_economists/\")\n\n\ncomments <- get_thread_content(blue_url)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in file(con, \"r\"): cannot open URL 'https://www.reddit.com/r/democrats/\ncomments/ye13dt/the_midterms_are_a_referendum_on_democracy_in/.json?limit=500':\nHTTP status was '429 Unknown Error'\n```\n:::\n\n::: {.cell-output .cell-output-error}\n```\nError in value[[3L]](cond): Cannot read from Reddit, check your inputs or internet connection\n```\n:::\n\n```{.r .cell-code}\nthree_comments <- comments[[\"comments\"]] #this is from the \"comments\" dataframe\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): object 'comments' not found\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n\nuse get_thread_urls\n\nthen use get_thread_content()\n\n```\n\n::: {.cell-output .cell-output-error}\n```\nError: <text>:2:5: unexpected symbol\n1: \n2: use get_thread_urls\n       ^\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nget_nrc_sentiment(three_comments$comment)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in get_nrc_sentiment(three_comments$comment): object 'three_comments' not found\n```\n:::\n:::\n\n## Webscrapping for Reddit Comments\n\nFirst, I want to check if I can even scrape the website for comments\n\n::: {.cell}\n\n```{.r .cell-code}\nbow(\"https://www.reddit.com/r/republicans/\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n<polite session> https://www.reddit.com/r/republicans/\n    User-agent: polite R package\n    robots.txt: 45 rules are defined for 7 bots\n   Crawl delay: 5 sec\n  The path is scrapable for this user-agent\n```\n:::\n\n```{.r .cell-code}\nbow(\"https://www.reddit.com/r/democrats/\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n<polite session> https://www.reddit.com/r/democrats/\n    User-agent: polite R package\n    robots.txt: 45 rules are defined for 7 bots\n   Crawl delay: 5 sec\n  The path is scrapable for this user-agent\n```\n:::\n:::\n\n\n## /r/democrats\nI'm having trouble scraping for comments. When I try to pull all of the comments for one post, my output is NA and I cannot firgure out why. When I pull a single comment though, I get the output I desire no problem.\n\n::: {.cell}\n\n```{.r .cell-code}\n# url for the main subreddit\nurl <- \"https://www.reddit.com/r/democrats/\"\n\ncom_url <- \"https://www.reddit.com/r/democrats/comments/ychxe8/new_battleground_polls_a_boon_for_dems/\"\n\n# To pull the comments for this specific post\ncss_selector  <- \"#t1_itmbw37 > div.Comment.t1_itmbw37.P8SGAKMtRxNwlmLz1zdJu.HZ-cv9q391bm8s7qT54B3._1z5rdmX8TDr6mqwNv7A70U > div._3tw__eCCe7j-epNCKGXUKk\"\n```\n:::\n\n\nuse get thread content\n\nset a specific time frame to look at a particular issue. Setting a time frame would be better\n\nStart doing more interesting stuff\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Here is where I run into an issue trying to get all the comments for one particular post\nreddit_post <- \"https://www.reddit.com/r/democrats/comments/ycha3g/supreme_court_puts_hold_on_order_that_graham/\"\ncss <- \"#overlayScrollContainer > div._1npCwF50X2J7Wt82SZi6J0 > div.u35lf2ynn4jHsVUwPmNU.Dx3UxiK86VcfkFQVHNXNi > div.uI_hDmU5GSiudtABRz_37 > div._2M2wOqmeoPVvcSsJ6Po9-V._3287nL7j7epK9JmDC3N1VR\"\n\nblue_post <- reddit_post %>% \n  read_html() %>%\n  html_node(css = css) %>% \n  html_text()\n```\n:::\n\n\n\n## Notes from other research\n\nReddit is not a great representation of the general public. It is a niche group, but can have more in depth discussion than Twitter. Reddit users are also, usually, passionate about certain ideas and subjects, therefore many users will talk freely about their ideas. \n\n## Previous Research\n\nA Tale of Two Subreddits: https://ojs.aaai.org/index.php/ICWSM/article/view/19347/19119\n\nNo echo in the chambers of political interactions on Reddit: https://www.nature.com/articles/s41598-021-81531-x\n\nDetermining Presidential Approval Rating Using Reddit Sentiment Analysis: https://towardsdatascience.com/determining-presidential-approval-rating-using-reddit-sentiment-analysis-7912fdb5fcc7\n\nhttps://www.researchgate.net/publication/349794705_Populist_Supporters_on_Reddit_A_Comparison_of_Content_and_Behavioral_Patterns_Within_Publics_of_Supporters_of_Donald_Trump_and_Hillary_Clinton\n\n",
    "supporting": [
      "blog_post_2_QH_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}